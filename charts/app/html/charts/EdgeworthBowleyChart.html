<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      -->
<title>EdgeworthBowleyChart</title>
<meta name="generator" content="MATLAB 25.1">
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
<meta name="DC.date" content="2025-01-11">
<meta name="DC.source" content="EdgeworthBowleyChart.m">
<style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style>
</head>
<body>
<div class="content">
<pre class="codeinput">
<span class="keyword">classdef</span> EdgeworthBowleyChart &lt; Chart
    <span class="comment">%EDGEWORTHBOWLEYCHART Creates an Edgeworth-Bowley chart based on the</span>
    <span class="comment">%utility curves of two individuals and the Pareto-efficient contract</span>
    <span class="comment">%curve.</span>

    <span class="comment">% Copyright 2018-2025 The MathWorks, Inc.</span>

    <span class="keyword">properties</span>
        <span class="comment">% Contract line width.</span>
        LineWidth<span class="typesection">(1, 1) double {mustBePositive, mustBeFinite}</span> = 1.5
        <span class="comment">% Contract line color.</span>
        LineColor <span class="typesection">{validatecolor}</span> = [0, 0.5, 0]
        <span class="comment">% Marker size.</span>
        MarkerSize<span class="typesection">(1, 1) double {mustBePositive, mustBeFinite}</span> = 8
    <span class="keyword">end</span> <span class="comment">% properties</span>

    <span class="keyword">properties</span> ( Dependent )
        <span class="comment">% Chart A-data: this is a matrix defining the utility curves for</span>
        <span class="comment">% the individual A.</span>
        AData<span class="typesection">(:, :) double {mustBeReal}</span>
        <span class="comment">% Chart B-data: this is a matrix defining the utility curves for</span>
        <span class="comment">% the individual B.</span>
        BData<span class="typesection">(:, :) double {mustBeReal}</span>
        <span class="comment">% Quantity of good 1.</span>
        Quantity1<span class="typesection">(1, 1) double {mustBeReal}</span>
        <span class="comment">% Quantity of good 2.</span>
        Quantity2<span class="typesection">(1, 1) double {mustBeReal}</span>
    <span class="keyword">end</span> <span class="comment">% properties ( Dependent )</span>

    <span class="keyword">properties</span> ( Access = private )
        <span class="comment">% Internal storage for the AData property.</span>
        AData_<span class="typesection">(:, :) double {mustBeReal}</span> = double.empty( 0, 1 )
        <span class="comment">% Internal storage for the BData property.</span>
        BData_<span class="typesection">(:, :) double {mustBeReal}</span> = double.empty( 0, 1 )
        <span class="comment">% Internal storage for the Quantity1 property.</span>
        Quantity1_<span class="typesection">(1, 1) double {mustBeReal}</span> = 1
        <span class="comment">% Internal storage for the Quantity2 property.</span>
        Quantity2_<span class="typesection">(1, 1) double {mustBeReal}</span> = 1
        <span class="comment">% Fitted curve data for A.</span>
        ACurveFit<span class="typesection">(:, :) double {mustBeReal}</span> = double.empty( 0, 0 )
        <span class="comment">% Fitted curve data for B.</span>
        BCurveFit<span class="typesection">(:, :) double {mustBeReal}</span> = double.empty( 0, 0 )
        <span class="comment">% Pareto set.</span>
        ParetoSet<span class="typesection">(:, :) double {mustBeReal}</span> = zeros( 2 )
        <span class="comment">% A coefficients.</span>
        ACoefficients<span class="typesection">(:, :) double {mustBeReal}</span> = double.empty( 0, 0 )
        <span class="comment">% B coefficients.</span>
        BCoefficients<span class="typesection">(:, :) double {mustBeReal}</span> = double.empty( 0, 0 )
        <span class="comment">% Logical scalar specifying whether a computation is required.</span>
        ComputationRequired<span class="typesection">(1, 1) logical </span>= false
    <span class="keyword">end</span> <span class="comment">% properties ( Access = private )</span>

    <span class="keyword">properties</span> ( Access = private, Transient, NonCopyable )
        <span class="comment">% Chart axes.</span>
        Axes<span class="typesection">(:, 1) matlab.graphics.axis.Axes {mustBeScalarOrEmpty}</span>
        <span class="comment">% Pareto-efficient curve.</span>
        ContractLine<span class="typesection">(:, 1) matlab.graphics.primitive.Line </span><span class="keyword">...</span>
            <span class="typesection">{mustBeScalarOrEmpty}</span>
        <span class="comment">% Utility line for A.</span>
        AUtilityLines<span class="typesection">(:, 1) matlab.graphics.primitive.Line</span>
        <span class="comment">% Utility line for B.</span>
        BUtilityLines<span class="typesection">(:, 1) matlab.graphics.primitive.Line</span>
        <span class="comment">% Scattered data points.</span>
        ScatterPoints<span class="typesection">(:, 1) matlab.graphics.primitive.Line </span><span class="keyword">...</span>
            <span class="typesection">{mustBeScalarOrEmpty}</span>
    <span class="keyword">end</span> <span class="comment">% properties ( Access = private, Transient, NonCopyable )</span>

    <span class="keyword">properties</span> ( Constant, Hidden )
        <span class="comment">% Product dependencies.</span>
        Dependencies<span class="typesection">(1, :) string </span>= [<span class="string">"MATLAB"</span>, <span class="keyword">...</span>
            <span class="string">"Statistics and Machine Learning Toolbox"</span>]
        <span class="comment">% Description.</span>
        ShortDescription<span class="typesection">(1, 1) string </span>= <span class="string">"Plot the utility curves of"</span> + <span class="keyword">...</span>
            <span class="string">" two individuals and the derived Pareto-efficient "</span> + <span class="keyword">...</span>
            <span class="string">"contract curve"</span>
    <span class="keyword">end</span> <span class="comment">% properties ( Constant, Hidden )</span>

    <span class="keyword">methods</span>

        <span class="keyword">function</span> value = get.AData( obj )

            value =  obj.AData_;

        <span class="keyword">end</span> <span class="comment">% get.AData</span>

        <span class="keyword">function</span> set.AData( obj, value )

            <span class="comment">% Mark the chart for an update.</span>
            obj.ComputationRequired = true;

            <span class="comment">% Update the internal chart data properties.</span>
            obj.Quantity1_ = value(end, 1);
            obj.ParetoSet(end, 1) = obj.Quantity1_;
            <span class="keyword">if</span> isempty( obj.BData_ )
                obj.Quantity2_ = max( value(:, 2:end), [], <span class="string">"all"</span> );
                obj.ParetoSet(end, 2) = obj.Quantity2_;
            <span class="keyword">else</span>
                maxA = max( value(:, 2:end), [], <span class="string">"all"</span> );
                maxB = max( obj.BData_(:, 2:end), [], <span class="string">"all"</span> );
                obj.Quantity2_ = max( maxA, maxB );
                obj.ParetoSet(end, 2) = obj.Quantity2_;
                <span class="comment">% If A is resized ...</span>
                obj.BData_ = obj.BData_(1:height( value ), :);
                <span class="comment">% If B is resized ...</span>
                obj.BCurveFit = NaN( size( obj.BData_ ) - [0, 1] );
                obj.ACurveFit = NaN( size( value ) - [0, 1] );
            <span class="keyword">end</span> <span class="comment">% if</span>

            <span class="comment">% Update the stored property.</span>
            obj.AData_ = value;
            <span class="comment">% Update the last point of ParetoSet.</span>
            obj.ParetoSet(end, 1) = obj.Quantity1_;
            obj.ParetoSet(end, 2) = obj.Quantity2_;

            <span class="comment">% Update the fitted curve.</span>
            <span class="keyword">if</span> ~isempty( obj.ACurveFit )
                obj.ACurveFit = obj.ACurveFit(1:height( value ), :);
            <span class="keyword">end</span> <span class="comment">% if</span>

        <span class="keyword">end</span> <span class="comment">% set.AData</span>

        <span class="keyword">function</span> value = get.BData( obj )

            value =  obj.BData_;

        <span class="keyword">end</span> <span class="comment">% get.BData</span>

        <span class="keyword">function</span> set.BData( obj, value )

            <span class="comment">% Mark the chart for an update.</span>
            obj.ComputationRequired = true;

            <span class="comment">% Update the internal chart data properties.</span>
            obj.Quantity1_ = value(end, 1);
            obj.ParetoSet(end, 1) = obj.Quantity1_;
            <span class="keyword">if</span> isempty( obj.AData_ )
                obj.Quantity2_ = max( value(:, 2:end), [], <span class="string">"all"</span> );
                obj.ParetoSet(end, 2) = obj.Quantity2_;
            <span class="keyword">else</span>
                maxB = max( value(:, 2:end), [], <span class="string">"all"</span> );
                maxA = max( obj.AData(:, 2:end), [], <span class="string">"all"</span> );
                obj.Quantity2_ = max( maxA, maxB );
                obj.ParetoSet(end, 2) = obj.Quantity2_;
                obj.AData_ = obj.AData_(1:height( value ), :);
                obj.ACurveFit = NaN( size( obj.AData_ ) - [0 1] );
                obj.BCurveFit = NaN( size( value ) - [0 1] );
            <span class="keyword">end</span>

            <span class="comment">% Update the stored property.</span>
            obj.BData_ = value;

        <span class="keyword">end</span> <span class="comment">% set.BData</span>

        <span class="keyword">function</span> value = get.Quantity1( obj )

            value = obj.Quantity1_;

        <span class="keyword">end</span> <span class="comment">% get.Quantity1</span>

        <span class="keyword">function</span> set.Quantity1( obj, value )

            <span class="comment">% Truncate AData and BData.</span>
            truncateAndAssignQ1( obj, value )

        <span class="keyword">end</span> <span class="comment">% set.Quantity1</span>

        <span class="keyword">function</span> value = get.Quantity2( obj )

            value = obj.Quantity2_;

        <span class="keyword">end</span> <span class="comment">% get.Quantity2</span>

        <span class="keyword">function</span> set.Quantity2( obj, Q )

            truncateAndAssignQ2( obj, Q )

        <span class="keyword">end</span> <span class="comment">% set.Quantity2</span>

    <span class="keyword">end</span> <span class="comment">% methods</span>

    <span class="keyword">methods</span>

        <span class="keyword">function</span> obj = EdgeworthBowleyChart( namedArgs )
            <span class="comment">%EDGEWORTHBOWLEYCHART Construct an EdgeworthBowleyChart, given</span>
            <span class="comment">%optional name-value arguments.</span>

            <span class="keyword">arguments</span> ( Input )
                namedArgs.?EdgeworthBowleyChart
            <span class="keyword">end</span> <span class="comment">% arguments ( Input )</span>

            <span class="comment">% Set any user-defined properties.</span>
            set( obj, namedArgs )

        <span class="keyword">end</span> <span class="comment">% constructor</span>

        <span class="keyword">function</span> varargout = xlabel( obj, varargin )

            [varargout{1:nargout}] = xlabel( obj.Axes, varargin{:} );

        <span class="keyword">end</span> <span class="comment">% xlabel</span>

        <span class="keyword">function</span> varargout = ylabel( obj, varargin )

            [varargout{1:nargout}] = ylabel( obj.Axes, varargin{:} );

        <span class="keyword">end</span> <span class="comment">% ylabel</span>

        <span class="keyword">function</span> varargout = title( obj, varargin )

            [varargout{1:nargout}] = title( obj.Axes, varargin{:} );

        <span class="keyword">end</span> <span class="comment">% title</span>

        <span class="keyword">function</span> grid( obj, varargin )

            grid( obj.Axes, varargin{:} )

        <span class="keyword">end</span> <span class="comment">% grid</span>

        <span class="keyword">function</span> varargout = axis( obj, varargin )

            [varargout{1:nargout}] = axis( obj.Axes, varargin{:} );

        <span class="keyword">end</span> <span class="comment">% axis</span>

    <span class="keyword">end</span> <span class="comment">% methods</span>

    <span class="keyword">methods</span> ( Access = protected )

        <span class="keyword">function</span> setup( obj )
            <span class="comment">%SETUP Initialize the chart graphics.</span>

            <span class="comment">% The chart's axes.</span>
            obj.Axes = axes( <span class="string">"Parent"</span>, obj.getLayout() );

            <span class="comment">% The contract line.</span>
            obj.ContractLine = line( <span class="string">"Parent"</span>, obj.Axes, <span class="keyword">...</span>
                <span class="string">"XData"</span>, NaN, <span class="keyword">...</span>
                <span class="string">"YData"</span>, NaN, <span class="keyword">...</span>
                <span class="string">"Color"</span>, [0, 0.5, 0], <span class="keyword">...</span>
                <span class="string">"LineStyle"</span>, <span class="string">"-"</span>, <span class="keyword">...</span>
                <span class="string">"Linewidth"</span>, 2, <span class="keyword">...</span>
                <span class="string">"LineJoin"</span>, <span class="string">"round"</span> );

            <span class="comment">% Utility lines for A.</span>
            obj.AUtilityLines = line( <span class="string">"Parent"</span>, obj.Axes, <span class="keyword">...</span>
                <span class="string">"XData"</span>, NaN, <span class="keyword">...</span>
                <span class="string">"YData"</span>, NaN, <span class="keyword">...</span>
                <span class="string">"LineWidth"</span>, 1.5, <span class="keyword">...</span>
                <span class="string">"Color"</span>, [0.5 0.5 0.5] );

            <span class="comment">% Utility lines for B.</span>
            obj.BUtilityLines = line( <span class="string">"Parent"</span>, obj.Axes, <span class="keyword">...</span>
                <span class="string">"XData"</span>, NaN, <span class="keyword">...</span>
                <span class="string">"YData"</span>, NaN, <span class="keyword">...</span>
                <span class="string">"LineWidth"</span>, 1.5, <span class="keyword">...</span>
                <span class="string">"Color"</span>, [0.5 0.5 0.5] );

            <span class="comment">% Scattered points.</span>
            obj.ScatterPoints = line( <span class="string">"Parent"</span>, obj.Axes, <span class="keyword">...</span>
                <span class="string">"XData"</span>, NaN, <span class="keyword">...</span>
                <span class="string">"YData"</span>, NaN, <span class="keyword">...</span>
                <span class="string">"Color"</span>, [0.5 0.5 0.8], <span class="keyword">...</span>
                <span class="string">"Marker"</span>, <span class="string">"."</span>, <span class="keyword">...</span>
                <span class="string">"MarkerSize"</span>, 8, <span class="keyword">...</span>
                <span class="string">"LineStyle"</span>, <span class="string">"none"</span> );

            <span class="comment">% Annotations.</span>
            xlabel( obj.Axes, <span class="string">"Quantity 1"</span> );
            ylabel( obj.Axes, <span class="string">"Quantity 2"</span> );
            title( obj.Axes, <span class="string">"Edgeworth-Bowley Chart"</span> )
            grid( obj.Axes, <span class="string">"on"</span> )

        <span class="keyword">end</span> <span class="comment">% setup</span>

        <span class="keyword">function</span> update( obj )
            <span class="comment">%UPDATE Refresh the chart graphics.</span>

            <span class="comment">% Refresh the chart graphics.</span>
            plotScatter( obj ) <span class="comment">% Plot the AData and BData</span>
            fitCurves( obj ) <span class="comment">% Obtain the fitted curves</span>
            plotFittedCurves( obj ) <span class="comment">% Plot the fitted lines</span>
            axis( obj.Axes, [0, obj.Quantity1_, <span class="keyword">...</span>
                0, obj.Quantity2_] )
            paretoSet( obj ) <span class="comment">% Evaluate the Pareto set</span>
            plotPareto( obj ) <span class="comment">% Plot the Pareto Set</span>
            set( obj.AUtilityLines, <span class="string">"LineWidth"</span>, obj.LineWidth )
            set( obj.BUtilityLines, <span class="string">"LineWidth"</span>, obj.LineWidth )
            set( obj.ContractLine, <span class="string">"LineWidth"</span>, obj.LineWidth )

            <span class="comment">% Update the chart's decorative properties.</span>
            obj.ScatterPoints.MarkerSize = obj.MarkerSize;
            obj.ContractLine.Color = obj.LineColor;

        <span class="keyword">end</span> <span class="comment">% update</span>

    <span class="keyword">end</span> <span class="comment">% methods ( Access = protected )</span>

    <span class="keyword">methods</span> ( Access = private )

        <span class="keyword">function</span> fitCurves( obj )
            <span class="comment">%FITCURVES Obtain the curves fitted from AData and BData and</span>
            <span class="comment">%store the values in the ACurveFit and BCurveFit properties.</span>

            <span class="comment">% Handle possible warning messages.</span>
            w = warning();
            oc = onCleanup( @() warning( w ) );
            warning( <span class="string">"off"</span> )

            ncols = width( obj.AData );

            <span class="comment">% Fit AData</span>
            <span class="keyword">if</span> ~isempty( obj.AData_ )
                x = obj.AData_(:, 1);
                obj.ACoefficients = zeros( width( obj.AData_ )-1, 3 );
                idx = false( height( obj.AData_ ), ncols-1 );
                <span class="keyword">for</span> k = 2:ncols
                    y = obj.AData_(:, k);
                    <span class="keyword">if</span> any(~isnan(y)) <span class="comment">% If y contains any number</span>
                        hyprb = @(b, x) b(1) + b(2)./(x - b(3));  <span class="comment">% Generalised Hyperbola</span>
                        B0 = [0; obj.Quantity1_; 0];
                        mdl = fitnlm( x, y, hyprb, B0 );
                        obj.ACoefficients(k-1, :) = mdl.Coefficients.Estimate';<span class="comment">% Store the coefficients</span>
                        obj.ACurveFit(:, k-1) = hyprb( mdl.Coefficients.Estimate, x );
                        idx(:, k-1) = obj.ACurveFit(:, k-1) &lt; mdl.Coefficients.Estimate(1);
                    <span class="keyword">else</span> <span class="comment">% If all y is NaN</span>
                        obj.ACoefficients(k-1, :) = NaN( 1, 3 );
                        obj.ACurveFit(:, k-1) = NaN;
                        idx(:, k-1) = obj.ACurveFit(:,k-1) &lt; mdl.Coefficients.Estimate(1);
                    <span class="keyword">end</span> <span class="comment">% if</span>
                <span class="keyword">end</span> <span class="comment">% for</span>
                obj.ACurveFit(idx(:, 2:end)) = NaN;
                idx = obj.ACurveFit &gt; obj.Quantity2_;
                obj.ACurveFit(idx)= NaN;
            <span class="keyword">end</span> <span class="comment">% if</span>

            <span class="comment">% Fit BData</span>
            <span class="keyword">if</span> ~isempty( obj.BData_ )
                x = obj.BData_(:, 1);
                obj.BCoefficients = zeros( width( obj.AData_ )-1, 3 );
                idx = false( height( obj.BData_ ), ncols-1 );
                <span class="keyword">for</span> k = 2:ncols
                    y = obj.BData_(:, k);
                    <span class="keyword">if</span> any(~isnan(y))
                        hyprb = @(b, x) b(1) + b(2)./(x - b(3));
                        B0 = [0; obj.Quantity1_; 0];
                        mdl = fitnlm( x, y, hyprb, B0 );
                        obj.BCoefficients(k-1, :) = <span class="keyword">...</span>
                            mdl.Coefficients.Estimate';
                        obj.BCurveFit(:, k-1) = <span class="keyword">...</span>
                            hyprb( mdl.Coefficients.Estimate, x );
                        idx(:, k-1) = obj.BCurveFit(:, k-1) <span class="keyword">...</span>
                            &lt; mdl.Coefficients.Estimate(1);
                    <span class="keyword">else</span>
                        obj.BCoefficients(k-1, :) = NaN( 1, 3 );
                        obj.BCurveFit(:, k-1) = NaN;
                        idx(:, k-1) = obj.BCurveFit(:, k-1) <span class="keyword">...</span>
                            &lt; mdl.Coefficients.Estimate(1);
                    <span class="keyword">end</span> <span class="comment">% if</span>
                <span class="keyword">end</span> <span class="comment">% for</span>
                obj.BCurveFit(idx(:, 2:end)) = NaN;
                idx = abs(obj.BCurveFit) &gt; obj.Quantity2_ | <span class="keyword">...</span>
                    obj.BCurveFit &lt; 0;
                obj.BCurveFit(idx) = NaN;
            <span class="keyword">end</span> <span class="comment">% if</span>

            <span class="comment">% Check the hyperbolas are consistent (they do not intersect).</span>

            <span class="comment">% AData.</span>
            <span class="keyword">if</span> ~isempty( obj.ACoefficients )
                k = 0;
                <span class="keyword">for</span> i = 2 : height( obj.ACoefficients )
                    <span class="keyword">if</span> ~isnan( obj.ACoefficients(i-1-k, 3) )
                        a3 = obj.ACoefficients(i-1-k, 3);
                    <span class="keyword">end</span> <span class="comment">% Check the previous third element is not a NaN</span>
                    <span class="keyword">if</span> ~isnan( obj.ACoefficients(i-1-k, 1) )
                        a1 = obj.ACoefficients(i-1-k, 1);
                    <span class="keyword">end</span> <span class="comment">% Check the previous first element is not a NaN</span>
                    <span class="keyword">if</span> (obj.ACoefficients(i-k,3)+1) &lt; a3 || <span class="keyword">...</span>
                            (obj.ACoefficients(i-k,1)+1) &lt; a1
                        obj.ACoefficients = <span class="keyword">...</span>
                            obj.ACoefficients([1:i-1-k i+1-k:end ],:);
                        k = k+1;
                        obj.ACurveFit(:, i) = NaN;
                        obj.AData_(:, i) = NaN;
                    <span class="keyword">end</span> <span class="comment">% if</span>
                <span class="keyword">end</span> <span class="comment">% for</span>
            <span class="keyword">end</span> <span class="comment">% if</span>

            <span class="comment">% BData.</span>
            <span class="keyword">if</span> ~isempty( obj.BCoefficients )
                k = 0;
                <span class="keyword">for</span> i = 2 : height( obj.BCoefficients )
                    <span class="keyword">if</span> ~isnan( obj.BCoefficients(i-1-k, 3) )
                        b3 = obj.BCoefficients(i-1-k, 3);
                    <span class="keyword">end</span> <span class="comment">% Check the previous third element is not a NaN</span>
                    <span class="keyword">if</span> ~isnan( obj.BCoefficients(i-1-k, 1) )
                        b1 = obj.BCoefficients(i-1-k, 1);
                    <span class="keyword">end</span> <span class="comment">% Check the previous first element is not a NaN</span>
                    <span class="keyword">if</span> (obj.BCoefficients(i-k, 3)+1) &lt; b3 || <span class="keyword">...</span>
                            (obj.BCoefficients(i-k, 1)+1) &lt; b1
                        obj.BCoefficients = <span class="keyword">...</span>
                            obj.BCoefficients([1:i-1-k i+1-k:end ], :);
                        k = k+1;
                        obj.BCurveFit(:, i) = NaN;
                        obj.BData_(:, i) = NaN;
                    <span class="keyword">end</span> <span class="comment">% if</span>
                <span class="keyword">end</span> <span class="comment">% for</span>
            <span class="keyword">end</span> <span class="comment">% if</span>

        <span class="keyword">end</span> <span class="comment">% fitCurves</span>

        <span class="keyword">function</span> plotFittedCurves( obj )
            <span class="comment">%PLOTFITTEDCURVES Plot the fitted curves.</span>

            <span class="keyword">if</span> ~isempty( obj.ACurveFit ) <span class="comment">% Check there is obj.AData_</span>
                nCurvesA = width( obj.ACurveFit );
                x = obj.AData_(:, 1);
                <span class="keyword">for</span> k = 1:nCurvesA
                    y = obj.ACurveFit(:, k);
                    <span class="keyword">if</span> height( obj.AUtilityLines ) &lt; k
                        obj.AUtilityLines(k, 1) = <span class="keyword">...</span>
                            line( <span class="string">"Parent"</span>, obj.Axes, <span class="keyword">...</span>
                            <span class="string">"XData"</span>, x, <span class="keyword">...</span>
                            <span class="string">"YData"</span>, y, <span class="keyword">...</span>
                            <span class="string">"LineStyle"</span>, <span class="string">"-"</span>, <span class="keyword">...</span>
                            <span class="string">"LineWidth"</span>, 1.5, <span class="keyword">...</span>
                            <span class="string">"Color"</span>, [0.5 0.5 0.6] );
                    <span class="keyword">else</span>
                        set( obj.AUtilityLines(k,1),<span class="keyword">...</span>
                            <span class="string">"XData"</span>, x,<span class="keyword">...</span>
                            <span class="string">"YData"</span>, y, <span class="keyword">...</span>
                            <span class="string">"LineStyle"</span>, <span class="string">"-"</span>, <span class="keyword">...</span>
                            <span class="string">"Color"</span>, [0.5 0.5 0.6] )
                    <span class="keyword">end</span> <span class="comment">% if</span>
                <span class="keyword">end</span> <span class="comment">% for</span>
            <span class="keyword">end</span> <span class="comment">% if</span>

            <span class="keyword">if</span> ~isempty( obj.BCurveFit ) <span class="comment">% Check there is obj.BData_</span>
                <span class="comment">% Invert the curves</span>
                BCF = obj.BCurveFit;
                BCF = flipud( BCF );
                BCF = obj.Quantity2_ - BCF;
                nCurvesB = width( BCF );
                x = obj.BData_(:, 1);
                <span class="keyword">for</span> k = 1:nCurvesB
                    y = BCF(:, k);
                    <span class="keyword">if</span> height( obj.BUtilityLines ) &lt; k
                        obj.BUtilityLines(k, 1) = line( <span class="keyword">...</span>
                            <span class="string">"Parent"</span>, obj.Axes, <span class="keyword">...</span>
                            <span class="string">"XData"</span>, x, <span class="keyword">...</span>
                            <span class="string">"YData"</span>, y, <span class="keyword">...</span>
                            <span class="string">"LineStyle"</span>, <span class="string">"-"</span>,<span class="keyword">...</span>
                            <span class="string">"LineWidth"</span>, 1.5, <span class="keyword">...</span>
                            <span class="string">"Color"</span>, [0.5 0.5 0.6] );
                    <span class="keyword">else</span>
                        set( obj.BUtilityLines(k,1), <span class="string">"XData"</span>, x,<span class="keyword">...</span>
                            <span class="string">"YData"</span>, y, <span class="keyword">...</span>
                            <span class="string">"LineStyle"</span>, <span class="string">"-"</span>,<span class="keyword">...</span>
                            <span class="string">"Color"</span>, [0.5 0.5 0.6] )
                    <span class="keyword">end</span> <span class="comment">% if</span>
                <span class="keyword">end</span> <span class="comment">% for</span>
            <span class="keyword">end</span> <span class="comment">% if</span>

        <span class="keyword">end</span> <span class="comment">% plotFittedCurves</span>

        <span class="keyword">function</span> paretoSet( obj )
            <span class="comment">%PARETOSET Obtain the Pareto set from the curves stored in the</span>
            <span class="comment">%ACurvedFit and BCurveFit properties and store it in the</span>
            <span class="comment">%ParetoSet property.</span>

            <span class="comment">% Initialize the property.</span>
            obj.ParetoSet = [obj.Quantity1, obj.Quantity2; 0, 0];

            <span class="comment">% Compute the Pareto set.</span>
            <span class="keyword">if</span> ~isempty( obj.ACurveFit ) &amp;&amp; ~isempty( obj.BCurveFit )
                Mx = obj.Quantity1;
                My = obj.Quantity2;
                <span class="keyword">for</span> k = 1 : height( obj.ACoefficients ) - 1
                    a1 = obj.ACoefficients(k, 1);
                    a2 = obj.ACoefficients(k, 2);
                    a3 = obj.ACoefficients(k, 3);
                    distance = obj.Quantity1_ * obj.Quantity2_;
                    <span class="keyword">for</span> l = 1:height( obj.BCoefficients )-1
                        b1 = obj.BCoefficients(l, 1);
                        b2 = obj.BCoefficients(l, 2);
                        b3 = obj.BCoefficients(l, 3);
                        <span class="comment">% Check the two curves intersect.</span>
                        <span class="comment">% Ya  = a1 + a2/(x-a3);</span>
                        <span class="comment">% Yb = My - [b1 + b2/(Mx-x-b3);</span>
                        YaMax = a1 + a2/(0.1);
                        YaMin = a1 + a2/(Mx - a3);
                        YbMax = My - (b1 + b2/(Mx-0.1));
                        YbMin = My - (b1 + b2/(0.1));
                        <span class="keyword">if</span> YaMax &gt; YbMax &amp;&amp; YaMin &gt; YbMin
                            xroots = [(b2 - a2 + Mx*a1 - My*a3 + Mx*b1 + My*b3 + a1*a3 - a1*b3 + a3*b1 - b1*b3 + (Mx^2*My^2 - 2*Mx^2*My*a1 - 2*Mx^2*My*b1 + Mx^2*a1^2 + 2*Mx^2*a1*b1 + Mx^2*b1^2 - 2*Mx*My^2*a3 - 2*Mx*My^2*b3 + 4*Mx*My*a1*a3 + 4*Mx*My*a1*b3 - 2*Mx*My*a2 + 4*Mx*My*a3*b1 + 4*Mx*My*b1*b3 - 2*Mx*My*b2 - 2*Mx*a1^2*a3 - 2*Mx*a1^2*b3 + 2*Mx*a1*a2 - 4*Mx*a1*a3*b1 - 4*Mx*a1*b1*b3 + 2*Mx*a1*b2 + 2*Mx*a2*b1 - 2*Mx*a3*b1^2 - 2*Mx*b1^2*b3 + 2*Mx*b1*b2 + My^2*a3^2 + 2*My^2*a3*b3 + My^2*b3^2 - 2*My*a1*a3^2 - 4*My*a1*a3*b3 - 2*My*a1*b3^2 + 2*My*a2*a3 + 2*My*a2*b3 - 2*My*a3^2*b1 - 4*My*a3*b1*b3 + 2*My*a3*b2 - 2*My*b1*b3^2 + 2*My*b2*b3 + a1^2*a3^2 + 2*a1^2*a3*b3 + a1^2*b3^2 - 2*a1*a2*a3 - 2*a1*a2*b3 + 2*a1*a3^2*b1 + 4*a1*a3*b1*b3 - 2*a1*a3*b2 + 2*a1*b1*b3^2 - 2*a1*b2*b3 + a2^2 - 2*a2*a3*b1 - 2*a2*b1*b3 - 2*a2*b2 + a3^2*b1^2 + 2*a3*b1^2*b3 - 2*a3*b1*b2 + b1^2*b3^2 - 2*b1*b2*b3 + b2^2)^(1/2) - Mx*My)/(2*(a1 - My + b1))
                                -(a2 - b2 - Mx*a1 + My*a3 - Mx*b1 - My*b3 - a1*a3 + a1*b3 - a3*b1 + b1*b3 + (Mx^2*My^2 - 2*Mx^2*My*a1 - 2*Mx^2*My*b1 + Mx^2*a1^2 + 2*Mx^2*a1*b1 + Mx^2*b1^2 - 2*Mx*My^2*a3 - 2*Mx*My^2*b3 + 4*Mx*My*a1*a3 + 4*Mx*My*a1*b3 - 2*Mx*My*a2 + 4*Mx*My*a3*b1 + 4*Mx*My*b1*b3 - 2*Mx*My*b2 - 2*Mx*a1^2*a3 - 2*Mx*a1^2*b3 + 2*Mx*a1*a2 - 4*Mx*a1*a3*b1 - 4*Mx*a1*b1*b3 + 2*Mx*a1*b2 + 2*Mx*a2*b1 - 2*Mx*a3*b1^2 - 2*Mx*b1^2*b3 + 2*Mx*b1*b2 + My^2*a3^2 + 2*My^2*a3*b3 + My^2*b3^2 - 2*My*a1*a3^2 - 4*My*a1*a3*b3 - 2*My*a1*b3^2 + 2*My*a2*a3 + 2*My*a2*b3 - 2*My*a3^2*b1 - 4*My*a3*b1*b3 + 2*My*a3*b2 - 2*My*b1*b3^2 + 2*My*b2*b3 + a1^2*a3^2 + 2*a1^2*a3*b3 + a1^2*b3^2 - 2*a1*a2*a3 - 2*a1*a2*b3 + 2*a1*a3^2*b1 + 4*a1*a3*b1*b3 - 2*a1*a3*b2 + 2*a1*b1*b3^2 - 2*a1*b2*b3 + a2^2 - 2*a2*a3*b1 - 2*a2*b1*b3 - 2*a2*b2 + a3^2*b1^2 + 2*a3*b1^2*b3 - 2*a3*b1*b2 + b1^2*b3^2 - 2*b1*b2*b3 + b2^2)^(1/2) + Mx*My)/(2*(a1 - My + b1))];
                            <span class="keyword">if</span> xroots(1) &gt; a3  &amp;&amp; xroots(2) &gt; a3 &amp;&amp; isreal( xroots )
                                yroots = a1 + a2./(xroots - a3);
                                xpareto = xroots(1) + 0.5 * (xroots(2)-xroots(1));
                                ypareto = yroots(1) + 0.5 * (yroots(2)-yroots(1));
                                distanceAns = distance;
                                distance = sqrt( (xroots(2)-xroots(1))^2+(yroots(2)-yroots(1))^2 );
                                <span class="keyword">if</span> distance &lt; distanceAns
                                    ParetoPoint = [xpareto, ypareto];
                                <span class="keyword">end</span> <span class="comment">% if</span>
                            <span class="keyword">end</span> <span class="comment">% if</span>
                        <span class="keyword">end</span> <span class="comment">% if</span>
                    <span class="keyword">end</span> <span class="comment">% for</span>
                    <span class="keyword">if</span> any( ParetoPoint ~= obj.ParetoSet(2, :) )
                        obj.ParetoSet = [obj.ParetoSet(1,:); ParetoPoint; obj.ParetoSet(2:end,:)];
                    <span class="keyword">end</span> <span class="comment">% if</span>
                <span class="keyword">end</span> <span class="comment">% for</span>

                <span class="comment">% Smooth the line.</span>
                queryPoints = 0:0.01:Mx;
                PS = pchip(obj.ParetoSet(:,1)', obj.ParetoSet(:,2)', queryPoints);
                obj.ParetoSet = [queryPoints', PS'];

            <span class="keyword">end</span> <span class="comment">% if</span>

        <span class="keyword">end</span> <span class="comment">% paretoSet</span>

        <span class="keyword">function</span> plotScatter( obj )
            <span class="comment">%PLOTSCATTER Visualize the values from AData_ and BData_ to the</span>
            <span class="comment">%corresponding chart graphics.</span>

            <span class="comment">% Reverse the BData matrix.</span>
            BD = obj.BData_;
            BD(:, 2:end) = flipud( BD(:, 2:end) );
            BD(:, 2:end) = obj.Quantity2_ - BD(:, 2:end);
            ncolsA = width( obj.AData_ );
            ncolsB = width( obj.BData_ );
            <span class="keyword">if</span> isempty( obj.AData_ )
                nrows = height( obj.BData_ );
            <span class="keyword">else</span>
                nrows = height( obj.AData_ );
            <span class="keyword">end</span> <span class="comment">% if</span>

            y = zeros( nrows*(ncolsA+ncolsB-2), 1 );
            x = zeros( nrows*(ncolsA+ncolsB-2), 1 );

            <span class="keyword">for</span> k = 2:ncolsA
                x((k-2)*nrows+1:(k-1)*nrows) = obj.AData_(:, 1);
                y((k-2)*nrows+1:(k-1)*nrows) = obj.AData_(:, k);
            <span class="keyword">end</span> <span class="comment">% for</span>

            <span class="keyword">for</span> k = 2+ncolsB:2*ncolsB
                x((k-2)*nrows+1:(k-1)*nrows) = obj.BData_(:, 1);
                y((k-2)*nrows+1:(k-1)*nrows) = BD(:, k-ncolsB);
            <span class="keyword">end</span> <span class="comment">% for</span>

            xlim( obj.Axes, [0, obj.Quantity1] )
            ylim( obj.Axes, [0, obj.Quantity2] )
            set( obj.ScatterPoints, <span class="string">"XData"</span>, x, <span class="string">"YData"</span>, y )

        <span class="keyword">end</span> <span class="comment">% plotScatter</span>

        <span class="keyword">function</span> plotPareto( obj )
            <span class="comment">%PLOTPARETO Update the contract line using the values from the</span>
            <span class="comment">%Pareto set.</span>

            <span class="keyword">if</span> ~isempty( obj.AData_ ) &amp;&amp; ~isempty( obj.BData_ ) &amp;&amp; <span class="keyword">...</span>
                    ~isempty( obj.ParetoSet )
                x = obj.ParetoSet(:, 1);
                y = obj.ParetoSet(:, 2);
                set( obj.ContractLine, <span class="string">"XData"</span>, x, <span class="string">"YData"</span>, y )
            <span class="keyword">end</span> <span class="comment">% if</span>

        <span class="keyword">end</span> <span class="comment">% plotPareto</span>

        <span class="keyword">function</span> truncateAndAssignQ1( obj, Q )

            <span class="comment">% If Q differs from the current quantity by too large a margin,</span>
            <span class="comment">% recall the method with an adjusted value of Q.</span>
            currentQ = obj.Quantity1_;
            <span class="keyword">if</span> (Q-currentQ) &gt; 1
                truncateAndAssignQ1( obj, Q-1 );
            <span class="keyword">elseif</span> (Q-currentQ) &lt; -1
                truncateAndAssignQ1( obj, Q+1 );
            <span class="keyword">end</span> <span class="comment">% if</span>

            <span class="comment">% Update the chart's internal data properties.</span>
            currentQ = obj.Quantity1_;
            <span class="keyword">if</span> Q &gt; currentQ
                step = diff( obj.AData_(1:2, 1) );
                num_steps = (Q-currentQ)/step+1;
                obj.AData_ = [obj.AData_; (currentQ:step:Q)', <span class="keyword">...</span>
                    NaN( num_steps, width( obj.AData_ )-1)];
                obj.BData_ = [obj.BData_; (currentQ:step:Q)', <span class="keyword">...</span>
                    NaN( num_steps, width( obj.BData_ )-1)];
                obj.ACurveFit = obj.AData(:, 2:end);
                obj.BCurveFit = obj.BData(:, 2:end);
                obj.ParetoSet = [0 0; 0 0];
            <span class="keyword">elseif</span> Q &lt; currentQ
                obj.AData_ = obj.AData_(1:sum( Q&gt;obj.AData_(:, 1) ), :);
                obj.BData_ = obj.BData_(1:sum( Q&gt;obj.BData_(:, 1) ), :);
                obj.ACurveFit = obj.AData(:, 2:end);
                obj.BCurveFit = obj.BData(:, 2:end);
                obj.ParetoSet = [0 0; 0 0];
            <span class="keyword">end</span>

            <span class="comment">% Store the quantity and update the Pareto set.</span>
            obj.Quantity1_ = Q;
            obj.ParetoSet(end, 1) = obj.Quantity1_;

        <span class="keyword">end</span> <span class="comment">% truncateAndAssignQ1</span>

        <span class="keyword">function</span> truncateAndAssignQ2( obj, Q )

            <span class="comment">% If Q differs from the current quantity by too large a margin,</span>
            <span class="comment">% recall the method with an adjusted value of Q.</span>
            currentQ = obj.Quantity2_;
            <span class="keyword">if</span> (Q-currentQ) &gt; 1
                truncateAndAssignQ2( obj, Q-1 );
            <span class="keyword">elseif</span> (Q-currentQ) &lt; -1
                truncateAndAssignQ2( obj, Q+1 );
            <span class="keyword">end</span> <span class="comment">% if</span>

            <span class="comment">% Update the chart's internal data properties.</span>
            <span class="comment">% If any Y data is bigger than the maximum quantity</span>
            <span class="keyword">if</span> Q &lt; currentQ
                idx = obj.AData_(:, 2:end) &gt; Q;
                obj.AData_([false( height( idx ), 1 ), idx]) = NaN;
                idx = obj.BData_(:, 2:end) &gt; Q;
                obj.BData_([false( height( idx ), 1 ), idx]) = NaN;
                obj.ACurveFit = obj.AData(:, 2:end);
                obj.BCurveFit = obj.BData(:, 2:end);
                obj.ParetoSet = zeros( 2 );
            <span class="keyword">end</span> <span class="comment">% if</span>

            <span class="comment">% Store the quantity and update the Pareto set.</span>
            obj.Quantity2_ = Q;
            obj.ParetoSet(end, 2) = obj.Quantity2_;

        <span class="keyword">end</span> <span class="comment">% truncateAndAssignQ2</span>

    <span class="keyword">end</span> <span class="comment">% methods ( Access = private )</span>

<span class="keyword">end</span> <span class="comment">% classdef</span>
</pre>
</div>
<!--
##### SOURCE BEGIN #####
classdef EdgeworthBowleyChart < Chart
    %EDGEWORTHBOWLEYCHART Creates an Edgeworth-Bowley chart based on the
    %utility curves of two individuals and the Pareto-efficient contract
    %curve.

    % Copyright 2018-2025 The MathWorks, Inc.

    properties
        % Contract line width.
        LineWidth(1, 1) double {mustBePositive, mustBeFinite} = 1.5
        % Contract line color.
        LineColor {validatecolor} = [0, 0.5, 0]
        % Marker size.
        MarkerSize(1, 1) double {mustBePositive, mustBeFinite} = 8
    end % properties

    properties ( Dependent )
        % Chart A-data: this is a matrix defining the utility curves for
        % the individual A.
        AData(:, :) double {mustBeReal}
        % Chart B-data: this is a matrix defining the utility curves for
        % the individual B.
        BData(:, :) double {mustBeReal}
        % Quantity of good 1.
        Quantity1(1, 1) double {mustBeReal}
        % Quantity of good 2.
        Quantity2(1, 1) double {mustBeReal}
    end % properties ( Dependent )

    properties ( Access = private )
        % Internal storage for the AData property.
        AData_(:, :) double {mustBeReal} = double.empty( 0, 1 )
        % Internal storage for the BData property.
        BData_(:, :) double {mustBeReal} = double.empty( 0, 1 )
        % Internal storage for the Quantity1 property.
        Quantity1_(1, 1) double {mustBeReal} = 1
        % Internal storage for the Quantity2 property.
        Quantity2_(1, 1) double {mustBeReal} = 1
        % Fitted curve data for A.
        ACurveFit(:, :) double {mustBeReal} = double.empty( 0, 0 )
        % Fitted curve data for B.
        BCurveFit(:, :) double {mustBeReal} = double.empty( 0, 0 )
        % Pareto set.
        ParetoSet(:, :) double {mustBeReal} = zeros( 2 )
        % A coefficients.
        ACoefficients(:, :) double {mustBeReal} = double.empty( 0, 0 )
        % B coefficients.
        BCoefficients(:, :) double {mustBeReal} = double.empty( 0, 0 )
        % Logical scalar specifying whether a computation is required.
        ComputationRequired(1, 1) logical = false
    end % properties ( Access = private )

    properties ( Access = private, Transient, NonCopyable )
        % Chart axes.
        Axes(:, 1) matlab.graphics.axis.Axes {mustBeScalarOrEmpty}
        % Pareto-efficient curve.
        ContractLine(:, 1) matlab.graphics.primitive.Line ...
            {mustBeScalarOrEmpty}
        % Utility line for A.
        AUtilityLines(:, 1) matlab.graphics.primitive.Line
        % Utility line for B.
        BUtilityLines(:, 1) matlab.graphics.primitive.Line
        % Scattered data points.
        ScatterPoints(:, 1) matlab.graphics.primitive.Line ...
            {mustBeScalarOrEmpty}
    end % properties ( Access = private, Transient, NonCopyable )

    properties ( Constant, Hidden )
        % Product dependencies.
        Dependencies(1, :) string = ["MATLAB", ...
            "Statistics and Machine Learning Toolbox"]
        % Description.
        ShortDescription(1, 1) string = "Plot the utility curves of" + ...
            " two individuals and the derived Pareto-efficient " + ...
            "contract curve"
    end % properties ( Constant, Hidden )

    methods

        function value = get.AData( obj )

            value =  obj.AData_;

        end % get.AData

        function set.AData( obj, value )

            % Mark the chart for an update.
            obj.ComputationRequired = true;

            % Update the internal chart data properties.
            obj.Quantity1_ = value(end, 1);
            obj.ParetoSet(end, 1) = obj.Quantity1_;
            if isempty( obj.BData_ )
                obj.Quantity2_ = max( value(:, 2:end), [], "all" );
                obj.ParetoSet(end, 2) = obj.Quantity2_;
            else
                maxA = max( value(:, 2:end), [], "all" );
                maxB = max( obj.BData_(:, 2:end), [], "all" );
                obj.Quantity2_ = max( maxA, maxB );
                obj.ParetoSet(end, 2) = obj.Quantity2_;
                % If A is resized ...
                obj.BData_ = obj.BData_(1:height( value ), :);
                % If B is resized ...
                obj.BCurveFit = NaN( size( obj.BData_ ) - [0, 1] );
                obj.ACurveFit = NaN( size( value ) - [0, 1] );
            end % if

            % Update the stored property.
            obj.AData_ = value;
            % Update the last point of ParetoSet.
            obj.ParetoSet(end, 1) = obj.Quantity1_;
            obj.ParetoSet(end, 2) = obj.Quantity2_;

            % Update the fitted curve.
            if ~isempty( obj.ACurveFit )
                obj.ACurveFit = obj.ACurveFit(1:height( value ), :);
            end % if

        end % set.AData

        function value = get.BData( obj )

            value =  obj.BData_;

        end % get.BData

        function set.BData( obj, value )

            % Mark the chart for an update.
            obj.ComputationRequired = true;

            % Update the internal chart data properties.
            obj.Quantity1_ = value(end, 1);
            obj.ParetoSet(end, 1) = obj.Quantity1_;
            if isempty( obj.AData_ )
                obj.Quantity2_ = max( value(:, 2:end), [], "all" );
                obj.ParetoSet(end, 2) = obj.Quantity2_;
            else
                maxB = max( value(:, 2:end), [], "all" );
                maxA = max( obj.AData(:, 2:end), [], "all" );
                obj.Quantity2_ = max( maxA, maxB );
                obj.ParetoSet(end, 2) = obj.Quantity2_;
                obj.AData_ = obj.AData_(1:height( value ), :);
                obj.ACurveFit = NaN( size( obj.AData_ ) - [0 1] );
                obj.BCurveFit = NaN( size( value ) - [0 1] );
            end

            % Update the stored property.
            obj.BData_ = value;

        end % set.BData

        function value = get.Quantity1( obj )

            value = obj.Quantity1_;

        end % get.Quantity1

        function set.Quantity1( obj, value )

            % Truncate AData and BData.
            truncateAndAssignQ1( obj, value )

        end % set.Quantity1

        function value = get.Quantity2( obj )

            value = obj.Quantity2_;

        end % get.Quantity2

        function set.Quantity2( obj, Q )

            truncateAndAssignQ2( obj, Q )

        end % set.Quantity2

    end % methods

    methods

        function obj = EdgeworthBowleyChart( namedArgs )
            %EDGEWORTHBOWLEYCHART Construct an EdgeworthBowleyChart, given
            %optional name-value arguments.

            arguments ( Input )
                namedArgs.?EdgeworthBowleyChart
            end % arguments ( Input )            

            % Set any user-defined properties.
            set( obj, namedArgs )

        end % constructor

        function varargout = xlabel( obj, varargin )

            [varargout{1:nargout}] = xlabel( obj.Axes, varargin{:} );

        end % xlabel

        function varargout = ylabel( obj, varargin )

            [varargout{1:nargout}] = ylabel( obj.Axes, varargin{:} );

        end % ylabel

        function varargout = title( obj, varargin )

            [varargout{1:nargout}] = title( obj.Axes, varargin{:} );

        end % title

        function grid( obj, varargin )

            grid( obj.Axes, varargin{:} )

        end % grid

        function varargout = axis( obj, varargin )
            
            [varargout{1:nargout}] = axis( obj.Axes, varargin{:} );

        end % axis

    end % methods

    methods ( Access = protected )

        function setup( obj )
            %SETUP Initialize the chart graphics.

            % The chart's axes.
            obj.Axes = axes( "Parent", obj.getLayout() );

            % The contract line.
            obj.ContractLine = line( "Parent", obj.Axes, ...
                "XData", NaN, ...
                "YData", NaN, ...
                "Color", [0, 0.5, 0], ...
                "LineStyle", "-", ...
                "Linewidth", 2, ...
                "LineJoin", "round" );

            % Utility lines for A.
            obj.AUtilityLines = line( "Parent", obj.Axes, ...
                "XData", NaN, ...
                "YData", NaN, ...
                "LineWidth", 1.5, ...
                "Color", [0.5 0.5 0.5] );

            % Utility lines for B.
            obj.BUtilityLines = line( "Parent", obj.Axes, ...
                "XData", NaN, ...
                "YData", NaN, ...
                "LineWidth", 1.5, ...
                "Color", [0.5 0.5 0.5] );

            % Scattered points.
            obj.ScatterPoints = line( "Parent", obj.Axes, ...
                "XData", NaN, ...
                "YData", NaN, ...
                "Color", [0.5 0.5 0.8], ...
                "Marker", ".", ...
                "MarkerSize", 8, ...
                "LineStyle", "none" );

            % Annotations.
            xlabel( obj.Axes, "Quantity 1" );
            ylabel( obj.Axes, "Quantity 2" );
            title( obj.Axes, "Edgeworth-Bowley Chart" )
            grid( obj.Axes, "on" )

        end % setup

        function update( obj )
            %UPDATE Refresh the chart graphics.

            % Refresh the chart graphics.
            plotScatter( obj ) % Plot the AData and BData
            fitCurves( obj ) % Obtain the fitted curves
            plotFittedCurves( obj ) % Plot the fitted lines
            axis( obj.Axes, [0, obj.Quantity1_, ...
                0, obj.Quantity2_] )
            paretoSet( obj ) % Evaluate the Pareto set
            plotPareto( obj ) % Plot the Pareto Set
            set( obj.AUtilityLines, "LineWidth", obj.LineWidth )
            set( obj.BUtilityLines, "LineWidth", obj.LineWidth )
            set( obj.ContractLine, "LineWidth", obj.LineWidth )

            % Update the chart's decorative properties.
            obj.ScatterPoints.MarkerSize = obj.MarkerSize;
            obj.ContractLine.Color = obj.LineColor;

        end % update

    end % methods ( Access = protected )

    methods ( Access = private )

        function fitCurves( obj )
            %FITCURVES Obtain the curves fitted from AData and BData and
            %store the values in the ACurveFit and BCurveFit properties.

            % Handle possible warning messages.
            w = warning();
            oc = onCleanup( @() warning( w ) );
            warning( "off" )

            ncols = width( obj.AData );

            % Fit AData
            if ~isempty( obj.AData_ )
                x = obj.AData_(:, 1);
                obj.ACoefficients = zeros( width( obj.AData_ )-1, 3 );
                idx = false( height( obj.AData_ ), ncols-1 );
                for k = 2:ncols
                    y = obj.AData_(:, k);
                    if any(~isnan(y)) % If y contains any number
                        hyprb = @(b, x) b(1) + b(2)./(x - b(3));  % Generalised Hyperbola
                        B0 = [0; obj.Quantity1_; 0];
                        mdl = fitnlm( x, y, hyprb, B0 );
                        obj.ACoefficients(k-1, :) = mdl.Coefficients.Estimate';% Store the coefficients
                        obj.ACurveFit(:, k-1) = hyprb( mdl.Coefficients.Estimate, x );
                        idx(:, k-1) = obj.ACurveFit(:, k-1) < mdl.Coefficients.Estimate(1);
                    else % If all y is NaN
                        obj.ACoefficients(k-1, :) = NaN( 1, 3 );
                        obj.ACurveFit(:, k-1) = NaN;
                        idx(:, k-1) = obj.ACurveFit(:,k-1) < mdl.Coefficients.Estimate(1);
                    end % if
                end % for
                obj.ACurveFit(idx(:, 2:end)) = NaN;
                idx = obj.ACurveFit > obj.Quantity2_;
                obj.ACurveFit(idx)= NaN;
            end % if

            % Fit BData
            if ~isempty( obj.BData_ )
                x = obj.BData_(:, 1);
                obj.BCoefficients = zeros( width( obj.AData_ )-1, 3 );
                idx = false( height( obj.BData_ ), ncols-1 );
                for k = 2:ncols
                    y = obj.BData_(:, k);
                    if any(~isnan(y))
                        hyprb = @(b, x) b(1) + b(2)./(x - b(3));
                        B0 = [0; obj.Quantity1_; 0];
                        mdl = fitnlm( x, y, hyprb, B0 );
                        obj.BCoefficients(k-1, :) = ...
                            mdl.Coefficients.Estimate';
                        obj.BCurveFit(:, k-1) = ...
                            hyprb( mdl.Coefficients.Estimate, x );
                        idx(:, k-1) = obj.BCurveFit(:, k-1) ...
                            < mdl.Coefficients.Estimate(1);
                    else
                        obj.BCoefficients(k-1, :) = NaN( 1, 3 );
                        obj.BCurveFit(:, k-1) = NaN;
                        idx(:, k-1) = obj.BCurveFit(:, k-1) ...
                            < mdl.Coefficients.Estimate(1);
                    end % if
                end % for
                obj.BCurveFit(idx(:, 2:end)) = NaN;
                idx = abs(obj.BCurveFit) > obj.Quantity2_ | ...
                    obj.BCurveFit < 0;
                obj.BCurveFit(idx) = NaN;
            end % if

            % Check the hyperbolas are consistent (they do not intersect).

            % AData.
            if ~isempty( obj.ACoefficients )
                k = 0;
                for i = 2 : height( obj.ACoefficients )
                    if ~isnan( obj.ACoefficients(i-1-k, 3) )
                        a3 = obj.ACoefficients(i-1-k, 3);
                    end % Check the previous third element is not a NaN
                    if ~isnan( obj.ACoefficients(i-1-k, 1) )
                        a1 = obj.ACoefficients(i-1-k, 1);
                    end % Check the previous first element is not a NaN
                    if (obj.ACoefficients(i-k,3)+1) < a3 || ...
                            (obj.ACoefficients(i-k,1)+1) < a1
                        obj.ACoefficients = ...
                            obj.ACoefficients([1:i-1-k i+1-k:end ],:);
                        k = k+1;
                        obj.ACurveFit(:, i) = NaN;
                        obj.AData_(:, i) = NaN;
                    end % if
                end % for
            end % if

            % BData.
            if ~isempty( obj.BCoefficients )
                k = 0;
                for i = 2 : height( obj.BCoefficients )
                    if ~isnan( obj.BCoefficients(i-1-k, 3) )
                        b3 = obj.BCoefficients(i-1-k, 3);
                    end % Check the previous third element is not a NaN
                    if ~isnan( obj.BCoefficients(i-1-k, 1) )
                        b1 = obj.BCoefficients(i-1-k, 1);
                    end % Check the previous first element is not a NaN
                    if (obj.BCoefficients(i-k, 3)+1) < b3 || ...
                            (obj.BCoefficients(i-k, 1)+1) < b1
                        obj.BCoefficients = ...
                            obj.BCoefficients([1:i-1-k i+1-k:end ], :);
                        k = k+1;
                        obj.BCurveFit(:, i) = NaN;
                        obj.BData_(:, i) = NaN;
                    end % if
                end % for
            end % if

        end % fitCurves

        function plotFittedCurves( obj )
            %PLOTFITTEDCURVES Plot the fitted curves.

            if ~isempty( obj.ACurveFit ) % Check there is obj.AData_
                nCurvesA = width( obj.ACurveFit );
                x = obj.AData_(:, 1);
                for k = 1:nCurvesA
                    y = obj.ACurveFit(:, k);
                    if height( obj.AUtilityLines ) < k
                        obj.AUtilityLines(k, 1) = ...
                            line( "Parent", obj.Axes, ...
                            "XData", x, ...
                            "YData", y, ...
                            "LineStyle", "-", ...
                            "LineWidth", 1.5, ...
                            "Color", [0.5 0.5 0.6] );
                    else
                        set( obj.AUtilityLines(k,1),...
                            "XData", x,...
                            "YData", y, ...
                            "LineStyle", "-", ...
                            "Color", [0.5 0.5 0.6] )
                    end % if
                end % for
            end % if

            if ~isempty( obj.BCurveFit ) % Check there is obj.BData_
                % Invert the curves
                BCF = obj.BCurveFit;
                BCF = flipud( BCF );
                BCF = obj.Quantity2_ - BCF;
                nCurvesB = width( BCF );
                x = obj.BData_(:, 1);
                for k = 1:nCurvesB
                    y = BCF(:, k);
                    if height( obj.BUtilityLines ) < k
                        obj.BUtilityLines(k, 1) = line( ...
                            "Parent", obj.Axes, ...
                            "XData", x, ...
                            "YData", y, ...
                            "LineStyle", "-",...
                            "LineWidth", 1.5, ...
                            "Color", [0.5 0.5 0.6] );
                    else
                        set( obj.BUtilityLines(k,1), "XData", x,...
                            "YData", y, ...
                            "LineStyle", "-",...
                            "Color", [0.5 0.5 0.6] )
                    end % if
                end % for
            end % if

        end % plotFittedCurves

        function paretoSet( obj )
            %PARETOSET Obtain the Pareto set from the curves stored in the
            %ACurvedFit and BCurveFit properties and store it in the
            %ParetoSet property.

            % Initialize the property.
            obj.ParetoSet = [obj.Quantity1, obj.Quantity2; 0, 0];

            % Compute the Pareto set.
            if ~isempty( obj.ACurveFit ) && ~isempty( obj.BCurveFit )
                Mx = obj.Quantity1;
                My = obj.Quantity2;
                for k = 1 : height( obj.ACoefficients ) - 1
                    a1 = obj.ACoefficients(k, 1);
                    a2 = obj.ACoefficients(k, 2);
                    a3 = obj.ACoefficients(k, 3);
                    distance = obj.Quantity1_ * obj.Quantity2_;
                    for l = 1:height( obj.BCoefficients )-1
                        b1 = obj.BCoefficients(l, 1);
                        b2 = obj.BCoefficients(l, 2);
                        b3 = obj.BCoefficients(l, 3);
                        % Check the two curves intersect.
                        % Ya  = a1 + a2/(x-a3);
                        % Yb = My - [b1 + b2/(Mx-x-b3);
                        YaMax = a1 + a2/(0.1);
                        YaMin = a1 + a2/(Mx - a3);
                        YbMax = My - (b1 + b2/(Mx-0.1));
                        YbMin = My - (b1 + b2/(0.1));
                        if YaMax > YbMax && YaMin > YbMin
                            xroots = [(b2 - a2 + Mx*a1 - My*a3 + Mx*b1 + My*b3 + a1*a3 - a1*b3 + a3*b1 - b1*b3 + (Mx^2*My^2 - 2*Mx^2*My*a1 - 2*Mx^2*My*b1 + Mx^2*a1^2 + 2*Mx^2*a1*b1 + Mx^2*b1^2 - 2*Mx*My^2*a3 - 2*Mx*My^2*b3 + 4*Mx*My*a1*a3 + 4*Mx*My*a1*b3 - 2*Mx*My*a2 + 4*Mx*My*a3*b1 + 4*Mx*My*b1*b3 - 2*Mx*My*b2 - 2*Mx*a1^2*a3 - 2*Mx*a1^2*b3 + 2*Mx*a1*a2 - 4*Mx*a1*a3*b1 - 4*Mx*a1*b1*b3 + 2*Mx*a1*b2 + 2*Mx*a2*b1 - 2*Mx*a3*b1^2 - 2*Mx*b1^2*b3 + 2*Mx*b1*b2 + My^2*a3^2 + 2*My^2*a3*b3 + My^2*b3^2 - 2*My*a1*a3^2 - 4*My*a1*a3*b3 - 2*My*a1*b3^2 + 2*My*a2*a3 + 2*My*a2*b3 - 2*My*a3^2*b1 - 4*My*a3*b1*b3 + 2*My*a3*b2 - 2*My*b1*b3^2 + 2*My*b2*b3 + a1^2*a3^2 + 2*a1^2*a3*b3 + a1^2*b3^2 - 2*a1*a2*a3 - 2*a1*a2*b3 + 2*a1*a3^2*b1 + 4*a1*a3*b1*b3 - 2*a1*a3*b2 + 2*a1*b1*b3^2 - 2*a1*b2*b3 + a2^2 - 2*a2*a3*b1 - 2*a2*b1*b3 - 2*a2*b2 + a3^2*b1^2 + 2*a3*b1^2*b3 - 2*a3*b1*b2 + b1^2*b3^2 - 2*b1*b2*b3 + b2^2)^(1/2) - Mx*My)/(2*(a1 - My + b1))
                                -(a2 - b2 - Mx*a1 + My*a3 - Mx*b1 - My*b3 - a1*a3 + a1*b3 - a3*b1 + b1*b3 + (Mx^2*My^2 - 2*Mx^2*My*a1 - 2*Mx^2*My*b1 + Mx^2*a1^2 + 2*Mx^2*a1*b1 + Mx^2*b1^2 - 2*Mx*My^2*a3 - 2*Mx*My^2*b3 + 4*Mx*My*a1*a3 + 4*Mx*My*a1*b3 - 2*Mx*My*a2 + 4*Mx*My*a3*b1 + 4*Mx*My*b1*b3 - 2*Mx*My*b2 - 2*Mx*a1^2*a3 - 2*Mx*a1^2*b3 + 2*Mx*a1*a2 - 4*Mx*a1*a3*b1 - 4*Mx*a1*b1*b3 + 2*Mx*a1*b2 + 2*Mx*a2*b1 - 2*Mx*a3*b1^2 - 2*Mx*b1^2*b3 + 2*Mx*b1*b2 + My^2*a3^2 + 2*My^2*a3*b3 + My^2*b3^2 - 2*My*a1*a3^2 - 4*My*a1*a3*b3 - 2*My*a1*b3^2 + 2*My*a2*a3 + 2*My*a2*b3 - 2*My*a3^2*b1 - 4*My*a3*b1*b3 + 2*My*a3*b2 - 2*My*b1*b3^2 + 2*My*b2*b3 + a1^2*a3^2 + 2*a1^2*a3*b3 + a1^2*b3^2 - 2*a1*a2*a3 - 2*a1*a2*b3 + 2*a1*a3^2*b1 + 4*a1*a3*b1*b3 - 2*a1*a3*b2 + 2*a1*b1*b3^2 - 2*a1*b2*b3 + a2^2 - 2*a2*a3*b1 - 2*a2*b1*b3 - 2*a2*b2 + a3^2*b1^2 + 2*a3*b1^2*b3 - 2*a3*b1*b2 + b1^2*b3^2 - 2*b1*b2*b3 + b2^2)^(1/2) + Mx*My)/(2*(a1 - My + b1))];
                            if xroots(1) > a3  && xroots(2) > a3 && isreal( xroots )
                                yroots = a1 + a2./(xroots - a3);
                                xpareto = xroots(1) + 0.5 * (xroots(2)-xroots(1));
                                ypareto = yroots(1) + 0.5 * (yroots(2)-yroots(1));
                                distanceAns = distance;
                                distance = sqrt( (xroots(2)-xroots(1))^2+(yroots(2)-yroots(1))^2 );
                                if distance < distanceAns
                                    ParetoPoint = [xpareto, ypareto];
                                end % if
                            end % if
                        end % if
                    end % for
                    if any( ParetoPoint ~= obj.ParetoSet(2, :) )
                        obj.ParetoSet = [obj.ParetoSet(1,:); ParetoPoint; obj.ParetoSet(2:end,:)];
                    end % if
                end % for

                % Smooth the line.
                queryPoints = 0:0.01:Mx;
                PS = pchip(obj.ParetoSet(:,1)', obj.ParetoSet(:,2)', queryPoints);
                obj.ParetoSet = [queryPoints', PS'];

            end % if

        end % paretoSet

        function plotScatter( obj )
            %PLOTSCATTER Visualize the values from AData_ and BData_ to the
            %corresponding chart graphics.

            % Reverse the BData matrix.
            BD = obj.BData_;
            BD(:, 2:end) = flipud( BD(:, 2:end) );
            BD(:, 2:end) = obj.Quantity2_ - BD(:, 2:end);
            ncolsA = width( obj.AData_ );
            ncolsB = width( obj.BData_ );
            if isempty( obj.AData_ )
                nrows = height( obj.BData_ );
            else
                nrows = height( obj.AData_ );
            end % if

            y = zeros( nrows*(ncolsA+ncolsB-2), 1 );
            x = zeros( nrows*(ncolsA+ncolsB-2), 1 );

            for k = 2:ncolsA
                x((k-2)*nrows+1:(k-1)*nrows) = obj.AData_(:, 1);
                y((k-2)*nrows+1:(k-1)*nrows) = obj.AData_(:, k);
            end % for

            for k = 2+ncolsB:2*ncolsB
                x((k-2)*nrows+1:(k-1)*nrows) = obj.BData_(:, 1);
                y((k-2)*nrows+1:(k-1)*nrows) = BD(:, k-ncolsB);
            end % for

            xlim( obj.Axes, [0, obj.Quantity1] )
            ylim( obj.Axes, [0, obj.Quantity2] )
            set( obj.ScatterPoints, "XData", x, "YData", y )

        end % plotScatter

        function plotPareto( obj )
            %PLOTPARETO Update the contract line using the values from the
            %Pareto set.

            if ~isempty( obj.AData_ ) && ~isempty( obj.BData_ ) && ...
                    ~isempty( obj.ParetoSet )
                x = obj.ParetoSet(:, 1);
                y = obj.ParetoSet(:, 2);
                set( obj.ContractLine, "XData", x, "YData", y )
            end % if

        end % plotPareto

        function truncateAndAssignQ1( obj, Q )

            % If Q differs from the current quantity by too large a margin,
            % recall the method with an adjusted value of Q.
            currentQ = obj.Quantity1_;
            if (Q-currentQ) > 1
                truncateAndAssignQ1( obj, Q-1 );
            elseif (Q-currentQ) < -1
                truncateAndAssignQ1( obj, Q+1 );
            end % if

            % Update the chart's internal data properties.
            currentQ = obj.Quantity1_;
            if Q > currentQ
                step = diff( obj.AData_(1:2, 1) );
                num_steps = (Q-currentQ)/step+1;
                obj.AData_ = [obj.AData_; (currentQ:step:Q)', ...
                    NaN( num_steps, width( obj.AData_ )-1)];
                obj.BData_ = [obj.BData_; (currentQ:step:Q)', ...
                    NaN( num_steps, width( obj.BData_ )-1)];
                obj.ACurveFit = obj.AData(:, 2:end);
                obj.BCurveFit = obj.BData(:, 2:end);
                obj.ParetoSet = [0 0; 0 0];
            elseif Q < currentQ
                obj.AData_ = obj.AData_(1:sum( Q>obj.AData_(:, 1) ), :);
                obj.BData_ = obj.BData_(1:sum( Q>obj.BData_(:, 1) ), :);
                obj.ACurveFit = obj.AData(:, 2:end);
                obj.BCurveFit = obj.BData(:, 2:end);
                obj.ParetoSet = [0 0; 0 0];
            end

            % Store the quantity and update the Pareto set.
            obj.Quantity1_ = Q;
            obj.ParetoSet(end, 1) = obj.Quantity1_;

        end % truncateAndAssignQ1

        function truncateAndAssignQ2( obj, Q )

            % If Q differs from the current quantity by too large a margin,
            % recall the method with an adjusted value of Q.
            currentQ = obj.Quantity2_;
            if (Q-currentQ) > 1
                truncateAndAssignQ2( obj, Q-1 );
            elseif (Q-currentQ) < -1
                truncateAndAssignQ2( obj, Q+1 );
            end % if

            % Update the chart's internal data properties.
            % If any Y data is bigger than the maximum quantity
            if Q < currentQ
                idx = obj.AData_(:, 2:end) > Q;
                obj.AData_([false( height( idx ), 1 ), idx]) = NaN;
                idx = obj.BData_(:, 2:end) > Q;
                obj.BData_([false( height( idx ), 1 ), idx]) = NaN;
                obj.ACurveFit = obj.AData(:, 2:end);
                obj.BCurveFit = obj.BData(:, 2:end);
                obj.ParetoSet = zeros( 2 );
            end % if

            % Store the quantity and update the Pareto set.
            obj.Quantity2_ = Q;
            obj.ParetoSet(end, 2) = obj.Quantity2_;

        end % truncateAndAssignQ2

    end % methods ( Access = private )

end % classdef
##### SOURCE END #####
-->
</body>
</html>
