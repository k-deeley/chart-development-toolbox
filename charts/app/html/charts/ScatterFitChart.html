<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      -->
<title>ScatterFitChart</title>
<meta name="generator" content="MATLAB 25.1">
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
<meta name="DC.date" content="2025-01-11">
<meta name="DC.source" content="ScatterFitChart.m">
<style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style>
</head>
<body>
<div class="content">
<pre class="codeinput">
<span class="keyword">classdef</span> ScatterFitChart &lt; Component
    <span class="comment">%SCATTERFITCHART Chart component managing 2D scattered data (x and y)</span>
    <span class="comment">%together with the corresponding best-fit line.</span>

    <span class="comment">% Copyright 2018-2025 The MathWorks, Inc.</span>

    <span class="keyword">properties</span> ( Dependent )
        <span class="comment">% Chart x-data.</span>
        XData<span class="typesection">(:, 1) double {mustBeReal}</span>
        <span class="comment">% Chart y-data.</span>
        YData<span class="typesection">(:, 1) double {mustBeReal}</span>
    <span class="keyword">end</span> <span class="comment">% properties ( Dependent )</span>

    <span class="keyword">properties</span>
        <span class="comment">% Size data for the scatter series.</span>
        SizeData<span class="typesection">(:, 1) double {mustBePositive, mustBeFinite}</span> = 36
        <span class="comment">% Color data for the scatter series.</span>
        CData<span class="typesection">(:, 3) double </span><span class="keyword">...</span>
            <span class="typesection">{mustBeInRange( CData, 0, 1 )}</span> = [0, 0.4470, 0.7410]
    <span class="keyword">end</span> <span class="comment">% properties</span>

    <span class="keyword">properties</span> ( Dependent )
        <span class="comment">% Visibility of the best-fit line.</span>
        LineVisible<span class="typesection">(1, 1) matlab.lang.OnOffSwitchState</span>
        <span class="comment">% Width of the best-fit line.</span>
        LineWidth<span class="typesection">(1, 1) double {mustBePositive, mustBeFinite}</span>
        <span class="comment">% Style of the best-fit line.</span>
        LineStyle<span class="typesection">(1, 1) string {mustBeLineStyle}</span>
        <span class="comment">% Scatter series marker.</span>
        Marker<span class="typesection">(1, 1) string {mustBeMarker}</span>
        <span class="comment">% Color of the best-fit line.</span>
        LineColor
        <span class="comment">% Axes x-grid.</span>
        XGrid<span class="typesection">(1, 1) matlab.lang.OnOffSwitchState</span>
        <span class="comment">% Axes y-grid.</span>
        YGrid<span class="typesection">(1, 1) matlab.lang.OnOffSwitchState</span>
        <span class="comment">% Visibility of the chart controls.</span>
        Controls<span class="typesection">(1, 1) matlab.lang.OnOffSwitchState</span>
    <span class="keyword">end</span> <span class="comment">% properties ( Dependent )</span>

    <span class="keyword">properties</span> ( Access = private )
        <span class="comment">% Internal storage for the XData property.</span>
        XData_<span class="typesection">(:, 1) double {mustBeReal}</span> = double.empty( 0, 1 )
        <span class="comment">% Internal storage for the YData property.</span>
        YData_<span class="typesection">(:, 1) double {mustBeReal}</span> = double.empty( 0, 1 )
        <span class="comment">% Logical scalar specifying whether a computation is required.</span>
        ComputationRequired<span class="typesection">(1, 1) logical </span>= false
    <span class="keyword">end</span> <span class="comment">% properties ( Access = private )</span>

    <span class="keyword">properties</span> ( Access = private, Transient, NonCopyable )
        <span class="comment">% Chart layout.</span>
        LayoutGrid<span class="typesection">(:, 1) matlab.ui.container.GridLayout </span><span class="keyword">...</span>
            <span class="typesection">{mustBeScalarOrEmpty}</span>
        <span class="comment">% Chart axes.</span>
        Axes<span class="typesection">(:, 1) matlab.graphics.axis.Axes {mustBeScalarOrEmpty}</span>
        <span class="comment">% Toggle button for the chart controls.</span>
        ToggleButton<span class="typesection">(:, 1) matlab.ui.controls.ToolbarStateButton </span><span class="keyword">...</span>
            <span class="typesection">{mustBeScalarOrEmpty}</span>
        <span class="comment">% Scatter series for the (x, y) data.</span>
        ScatterSeries<span class="typesection">(:, 1) matlab.graphics.chart.primitive.Scatter </span><span class="keyword">...</span>
            <span class="typesection">{mustBeScalarOrEmpty}</span>
        <span class="comment">% Line object for the best-fit line.</span>
        BestFitLine<span class="typesection">(:, 1) matlab.graphics.primitive.Line </span><span class="keyword">...</span>
            <span class="typesection">{mustBeScalarOrEmpty}</span>
        <span class="comment">% Label to display a summary of the best-fit line statistics.</span>
        SummaryLabel<span class="typesection">(:, 1) matlab.ui.control.Label {mustBeScalarOrEmpty}</span>
        <span class="comment">% Check box for the best-fit line visibility.</span>
        BestFitLineCheckBox<span class="typesection">(:, 1) matlab.ui.control.CheckBox </span><span class="keyword">...</span>
            <span class="typesection">{mustBeScalarOrEmpty}</span>
        <span class="comment">% Spinner for selecting the width of the best-fit line.</span>
        LineWidthSpinner<span class="typesection">(:, 1) matlab.ui.control.Spinner </span><span class="keyword">...</span>
            <span class="typesection">{mustBeScalarOrEmpty}</span>
        <span class="comment">% Dropdown menu for selecting the style of the best-fit line.</span>
        LineStyleDropDown<span class="typesection">(:, 1) matlab.ui.control.DropDown </span><span class="keyword">...</span>
            <span class="typesection">{mustBeScalarOrEmpty}</span>
        <span class="comment">% Dropdown menu for selecting the marker of the scatter plot.</span>
        MarkerDropDown<span class="typesection">(:, 1) matlab.ui.control.DropDown </span><span class="keyword">...</span>
            <span class="typesection">{mustBeScalarOrEmpty}</span>
        <span class="comment">% Color picker for the best-fit line.</span>
        LineColorPicker<span class="typesection">(:, 1) matlab.ui.control.ColorPicker </span><span class="keyword">...</span>
            <span class="typesection">{mustBeScalarOrEmpty}</span>
        <span class="comment">% Check box for the axes' XGrid visibility.</span>
        XGridCheckBox<span class="typesection">(:, 1) matlab.ui.control.CheckBox </span><span class="keyword">...</span>
            <span class="typesection">{mustBeScalarOrEmpty}</span>
        <span class="comment">% Check box for the axes' YGrid visibility.</span>
        YGridCheckBox<span class="typesection">(:, 1) matlab.ui.control.CheckBox </span><span class="keyword">...</span>
            <span class="typesection">{mustBeScalarOrEmpty}</span>
    <span class="keyword">end</span> <span class="comment">% properties ( Access = private, Transient, NonCopyable )</span>

    <span class="keyword">properties</span> ( Constant, Hidden )
        <span class="comment">% Product dependencies.</span>
        Dependencies<span class="typesection">(1, :) string </span>= [<span class="string">"MATLAB"</span>, <span class="keyword">...</span>
            <span class="string">"Statistics and Machine Learning Toolbox"</span>]
        <span class="comment">% Description.</span>
        ShortDescription<span class="typesection">(1, 1) string </span>= <span class="string">"Manage bivariate scattered"</span> + <span class="keyword">...</span>
            <span class="string">" data together with the line of best fit"</span>
    <span class="keyword">end</span> <span class="comment">% properties ( Constant, Hidden )</span>

    <span class="keyword">properties</span> ( Constant, GetAccess = private )
        <span class="comment">% Warning ID which may arise when fitting the line.</span>
        FitWarningID<span class="typesection">(1, 1) string </span>= <span class="string">"stats:LinearModel:RankDefDesignMat"</span>
    <span class="keyword">end</span> <span class="comment">% properties ( Constant, GetAccess = private )</span>

    <span class="keyword">methods</span>

        <span class="keyword">function</span> value = get.XData( obj )

            value = obj.XData_;

        <span class="keyword">end</span> <span class="comment">% get.XData</span>

        <span class="keyword">function</span> set.XData( obj, value )

            <span class="comment">% Mark the chart for an update.</span>
            obj.ComputationRequired = true;

            <span class="comment">% Decide how to modify the chart data.</span>
            nX = numel( value );
            nY = numel( obj.YData_ );

            <span class="keyword">if</span> nX &lt; nY <span class="comment">% If the new x-data is too short ...</span>
                <span class="comment">% ... then chop the chart y-data.</span>
                obj.YData_ = obj.YData_(1:nX);
            <span class="keyword">else</span>
                <span class="comment">% Otherwise, if nX &gt;= nY, then pad the y-data.</span>
                obj.YData_(end+1:nX, 1) = NaN;
            <span class="keyword">end</span> <span class="comment">% if</span>

            <span class="comment">% Set the internal x-data.</span>
            obj.XData_ = value;

            <span class="comment">% Reset the scatter series' color and size data if necessary.</span>
            nC = height( obj.CData );
            <span class="keyword">if</span> nC &gt; 1 &amp;&amp; nX ~= nC
                obj.CData = obj.Axes.ColorOrder(1, :);
            <span class="keyword">end</span> <span class="comment">% if</span>
            nS = numel( obj.SizeData );
            <span class="keyword">if</span> nS &gt; 1 &amp;&amp; nX ~= nS
                obj.SizeData = 36;
            <span class="keyword">end</span> <span class="comment">% if</span>

        <span class="keyword">end</span> <span class="comment">% set.XData</span>

        <span class="keyword">function</span> value = get.YData( obj )

            value = obj.YData_;

        <span class="keyword">end</span> <span class="comment">% get.YData</span>

        <span class="keyword">function</span> set.YData( obj, value )

            <span class="comment">% Mark the chart for an update.</span>
            obj.ComputationRequired = true;

            <span class="comment">% Decide how to modify the chart data.</span>
            nY = numel( value );
            nX = numel( obj.XData_ );

            <span class="keyword">if</span> nY &lt; nX <span class="comment">% If the new y-data is too short ...</span>
                <span class="comment">% ... then chop the chart x-data.</span>
                obj.XData_ = obj.XData_(1:nY);
            <span class="keyword">else</span>
                <span class="comment">% Otherwise, if nY &gt;= nX, then pad the x-data.</span>
                obj.XData_(end+1:nY, 1) = NaN;
            <span class="keyword">end</span> <span class="comment">% if</span>

            <span class="comment">% Set the internal y-data.</span>
            obj.YData_ = value;

            <span class="comment">% Reset the color and size data if necessary.</span>
            nC = height( obj.CData );
            <span class="keyword">if</span> nC &gt; 1 &amp;&amp; nY ~= nC
                obj.CData = obj.Axes.ColorOrder(1, :);
            <span class="keyword">end</span> <span class="comment">% if</span>
            nS = numel( obj.SizeData );
            <span class="keyword">if</span> nS &gt; 1 &amp;&amp; nY ~= nS
                obj.SizeData = 36;
            <span class="keyword">end</span> <span class="comment">% if</span>

        <span class="keyword">end</span> <span class="comment">% set.YData</span>

        <span class="keyword">function</span> value = get.LineVisible( obj )

            value = obj.BestFitLine.Visible;

        <span class="keyword">end</span> <span class="comment">% get.LineVisible</span>

        <span class="keyword">function</span> set.LineVisible( obj, value )

            <span class="comment">% Update the property.</span>
            obj.BestFitLine.Visible = value;

            <span class="comment">% Update the check box.</span>
            obj.BestFitLineCheckBox.Value = value;

        <span class="keyword">end</span> <span class="comment">% set.LineVisible</span>

        <span class="keyword">function</span> value = get.LineWidth( obj )

            value = obj.BestFitLine.LineWidth;

        <span class="keyword">end</span> <span class="comment">% get.LineWidth</span>

        <span class="keyword">function</span> set.LineWidth( obj, value )

            <span class="comment">% Update the property.</span>
            obj.BestFitLine.LineWidth = value;
            <span class="comment">% Update the spinner.</span>
            obj.LineWidthSpinner.Value = value;

        <span class="keyword">end</span> <span class="comment">% set.LineWidth</span>

        <span class="keyword">function</span> value = get.LineStyle( obj )

            value = obj.BestFitLine.LineStyle;

        <span class="keyword">end</span> <span class="comment">% get.LineStyle</span>

        <span class="keyword">function</span> set.LineStyle( obj, value )

            <span class="comment">% Update the property.</span>
            obj.BestFitLine.LineStyle = value;

            <span class="comment">% Update the dropdown menu.</span>
            obj.LineStyleDropDown.Value = value;

        <span class="keyword">end</span> <span class="comment">% set.LineStyle</span>

        <span class="keyword">function</span> value = get.Marker( obj )

            value = obj.ScatterSeries.Marker;

        <span class="keyword">end</span> <span class="comment">% get.Marker</span>

        <span class="keyword">function</span> set.Marker( obj, value )

            <span class="comment">% Update the property.</span>
            obj.ScatterSeries.Marker = value;

            <span class="comment">% Update the dropdown menu.</span>
            obj.MarkerDropDown.Value = validatestring( value, <span class="keyword">...</span>
                obj.MarkerDropDown.Items );

        <span class="keyword">end</span> <span class="comment">% set.Marker</span>

        <span class="keyword">function</span> value = get.LineColor( obj )

            value = obj.BestFitLine.Color;

        <span class="keyword">end</span> <span class="comment">% get.LineColor</span>

        <span class="keyword">function</span> set.LineColor( obj, value )

            <span class="comment">% Validate the proposed value.</span>
            value = validatecolor( value );

            <span class="comment">% Update the line.</span>
            obj.BestFitLine.Color = value;

            <span class="comment">% Update the color picker.</span>
            obj.LineColorPicker.Value = obj.LineColor;

        <span class="keyword">end</span> <span class="comment">% set.LineColor</span>

        <span class="keyword">function</span> value = get.XGrid( obj )

            value = obj.Axes.XGrid;

        <span class="keyword">end</span> <span class="comment">% set.XGrid</span>

        <span class="keyword">function</span> set.XGrid( obj, value )

            <span class="comment">% Set the property.</span>
            obj.Axes.XGrid = value;

            <span class="comment">% Update the checkbox.</span>
            obj.XGridCheckBox.Value = value;

        <span class="keyword">end</span> <span class="comment">% set.XGrid</span>

        <span class="keyword">function</span> value = get.YGrid( obj )

            value = obj.Axes.YGrid;

        <span class="keyword">end</span> <span class="comment">% get.YGrid</span>

        <span class="keyword">function</span> set.YGrid( obj, value )

            <span class="comment">% Set the property.</span>
            obj.Axes.YGrid = value;

            <span class="comment">% Update the checkbox.</span>
            obj.YGridCheckBox.Value = value;

        <span class="keyword">end</span> <span class="comment">% set.YGrid</span>

        <span class="keyword">function</span> value = get.Controls( obj )

            value = obj.ToggleButton.Value;

        <span class="keyword">end</span> <span class="comment">% get.Controls</span>

        <span class="keyword">function</span> set.Controls( obj, value )

            <span class="comment">% Update the toggle button.</span>
            obj.ToggleButton.Value = value;

            <span class="comment">% Invoke the toggle button callback.</span>
            obj.onToggleButtonPressed()

        <span class="keyword">end</span> <span class="comment">% set.Controls</span>

    <span class="keyword">end</span> <span class="comment">% methods</span>

    <span class="keyword">methods</span>

        <span class="keyword">function</span> obj = ScatterFitChart( namedArgs )
            <span class="comment">%SCATTERFITCHART Construct a ScatterFitChart, given optional</span>
            <span class="comment">%name-value arguments.</span>

            <span class="keyword">arguments</span> ( Input )
                namedArgs.?ScatterFitChart
            <span class="keyword">end</span> <span class="comment">% arguments ( Input )</span>

            <span class="comment">% Set any user-specified properties.</span>
            set( obj, namedArgs )

        <span class="keyword">end</span> <span class="comment">% constructor</span>

        <span class="keyword">function</span> varargout = xlabel( obj, varargin )

            [varargout{1:nargout}] = xlabel( obj.Axes, varargin{:} );

        <span class="keyword">end</span> <span class="comment">% xlabel</span>

        <span class="keyword">function</span> varargout = ylabel( obj, varargin )

            [varargout{1:nargout}] = ylabel( obj.Axes, varargin{:} );

        <span class="keyword">end</span> <span class="comment">% ylabel</span>

        <span class="keyword">function</span> varargout = title( obj, varargin )

            [varargout{1:nargout}] = title( obj.Axes, varargin{:} );

        <span class="keyword">end</span> <span class="comment">% title</span>

        <span class="keyword">function</span> grid( obj, varargin )

            <span class="comment">% Invoke grid on the axes.</span>
            grid( obj.Axes, varargin{:} )

            <span class="comment">% Ensure the controls are up-to-date. This can be done by</span>
            <span class="comment">% setting the XGrid/YGrid chart properties, which in turn will</span>
            <span class="comment">% refresh the controls.</span>
            obj.XGrid = obj.Axes.XGrid;
            obj.YGrid = obj.Axes.YGrid;

        <span class="keyword">end</span> <span class="comment">% grid</span>

        <span class="keyword">function</span> varargout = legend( obj, varargin )

            [varargout{1:nargout}] = legend( obj.Axes, varargin{:} );

        <span class="keyword">end</span> <span class="comment">% legend</span>

        <span class="keyword">function</span> varargout = axis( obj, varargin )

            [varargout{1:nargout}] = axis( obj.Axes, varargin{:} );

        <span class="keyword">end</span> <span class="comment">% axis</span>

        <span class="keyword">function</span> exportgraphics( obj, varargin )

            exportgraphics( obj.Axes, varargin{:} )

        <span class="keyword">end</span> <span class="comment">% exportgraphics</span>

    <span class="keyword">end</span> <span class="comment">% methods</span>

    <span class="keyword">methods</span> ( Access = protected )

        <span class="keyword">function</span> setup( obj )
            <span class="comment">%SETUP Initialize the chart graphics.</span>

            <span class="comment">% Define the layout grid.</span>
            obj.LayoutGrid = uigridlayout( obj, [1, 2], <span class="keyword">...</span>
                <span class="string">"ColumnWidth"</span>, [<span class="string">"1x"</span>, <span class="string">"0x"</span>] );

            <span class="comment">% Create the chart's axes.</span>
            obj.Axes = axes( <span class="string">"Parent"</span>, obj.LayoutGrid );

            <span class="comment">% Add a state button to show/hide the chart's controls.</span>
            tb = axtoolbar( obj.Axes, <span class="string">"default"</span> );
            iconPath = fullfile( chartsRoot(), <span class="string">"charts"</span>, <span class="keyword">...</span>
                <span class="string">"images"</span>, <span class="string">"Cog.png"</span> );
            obj.ToggleButton = axtoolbarbtn( tb, <span class="string">"state"</span>, <span class="keyword">...</span>
                <span class="string">"Value"</span>, <span class="string">"off"</span>, <span class="keyword">...</span>
                <span class="string">"Tooltip"</span>, <span class="string">"Show chart controls"</span>, <span class="keyword">...</span>
                <span class="string">"Icon"</span>, iconPath, <span class="keyword">...</span>
                <span class="string">"ValueChangedFcn"</span>, @obj.onToggleButtonPressed );

            <span class="comment">% Create the scatter series.</span>
            hold( obj.Axes, <span class="string">"on"</span> )
            obj.ScatterSeries = scatter( obj.Axes, NaN, NaN, <span class="string">"."</span>, <span class="keyword">...</span>
                <span class="string">"CData"</span>, obj.CData, <span class="keyword">...</span>
                <span class="string">"DisplayName"</span>, <span class="string">"Data"</span> );
            hold( obj.Axes, <span class="string">"off"</span> )

            <span class="comment">% Create the line object for the best-fit line.</span>
            obj.BestFitLine = line( obj.Axes, NaN, NaN, <span class="keyword">...</span>
                <span class="string">"LineWidth"</span>, 1.5, <span class="keyword">...</span>
                <span class="string">"Color"</span>, obj.Axes.ColorOrder(2, :), <span class="keyword">...</span>
                <span class="string">"DisplayName"</span>, <span class="string">"Best-fit line"</span> );

            <span class="comment">% Annotate the axes and add the legend.</span>
            xlabel( obj.Axes, <span class="string">"x"</span> )
            ylabel( obj.Axes, <span class="string">"y"</span> )
            title( obj.Axes, <span class="string">"y vs. x"</span> )
            legend( obj.Axes )

            <span class="comment">% Add the chart controls.</span>
            p = uipanel( <span class="string">"Parent"</span>, obj.LayoutGrid, <span class="keyword">...</span>
                <span class="string">"Title"</span>, <span class="string">"Chart Controls"</span>, <span class="keyword">...</span>
                <span class="string">"FontWeight"</span>, <span class="string">"bold"</span> );
            p.Layout.Column = 2;
            controlLayout = uigridlayout( p, [8, 2], <span class="keyword">...</span>
                <span class="string">"RowHeight"</span>, repmat( <span class="string">"fit"</span>, 1, 8 ) );

            <span class="comment">% Summary label.</span>
            obj.SummaryLabel = uilabel( <span class="string">"Parent"</span>, controlLayout, <span class="keyword">...</span>
                <span class="string">"Text"</span>, <span class="string">""</span> );
            obj.SummaryLabel.Layout.Column = [1, 2];

            <span class="comment">% Best-fit line visibility toggle.</span>
            obj.BestFitLineCheckBox = uicheckbox( <span class="keyword">...</span>
                <span class="string">"Parent"</span>, controlLayout, <span class="keyword">...</span>
                <span class="string">"Value"</span>, true, <span class="keyword">...</span>
                <span class="string">"Text"</span>, <span class="string">"Show best-fit line"</span>, <span class="keyword">...</span>
                <span class="string">"Tooltip"</span>, <span class="keyword">...</span>
                <span class="string">"Hide or show the best-fit line"</span>, <span class="keyword">...</span>
                <span class="string">"ValueChangedFcn"</span>, @obj.toggleLineVisibility );
            obj.BestFitLineCheckBox.Layout.Column = [1, 2];

            <span class="comment">% Best-fit line width selector.</span>
            uilabel( <span class="string">"Parent"</span>, controlLayout, <span class="keyword">...</span>
                <span class="string">"Text"</span>, <span class="string">"Line width:"</span> );
            obj.LineWidthSpinner = uispinner( <span class="string">"Parent"</span>, controlLayout, <span class="keyword">...</span>
                <span class="string">"Limits"</span>, [0, Inf], <span class="keyword">...</span>
                <span class="string">"LowerLimitInclusive"</span>, <span class="string">"off"</span>, <span class="keyword">...</span>
                <span class="string">"Step"</span>, 0.5, <span class="keyword">...</span>
                <span class="string">"Tooltip"</span>, <span class="string">"Select the width of the best-fit line"</span>, <span class="keyword">...</span>
                <span class="string">"Value"</span>, obj.BestFitLine.LineWidth, <span class="keyword">...</span>
                <span class="string">"ValueDisplayFormat"</span>, <span class="string">"%.1f"</span>, <span class="keyword">...</span>
                <span class="string">"ValueChangedFcn"</span>, @obj.onLineWidthSelected );

            <span class="comment">% Best-fit line style selector.</span>
            uilabel( <span class="string">"Parent"</span>, controlLayout, <span class="keyword">...</span>
                <span class="string">"Text"</span>, <span class="string">"Line style:"</span> );
            obj.LineStyleDropDown = uidropdown( <span class="keyword">...</span>
                <span class="string">"Parent"</span>, controlLayout, <span class="keyword">...</span>
                <span class="string">"Items"</span>, set( obj.BestFitLine, <span class="string">"LineStyle"</span> ), <span class="keyword">...</span>
                <span class="string">"Tooltip"</span>, <span class="string">"Select the style of the best-fit line"</span>, <span class="keyword">...</span>
                <span class="string">"Value"</span>, obj.BestFitLine.LineStyle, <span class="keyword">...</span>
                <span class="string">"ValueChangedFcn"</span>, @obj.onLineStyleSelected );

            <span class="comment">% Best-fit line color selector.</span>
            obj.LineColorPicker = uicolorpicker( <span class="keyword">...</span>
                <span class="string">"Parent"</span>, controlLayout, <span class="keyword">...</span>
                <span class="string">"Tooltip"</span>, <span class="string">"Select the color of the best-fit line"</span>, <span class="keyword">...</span>
                <span class="string">"Value"</span>, obj.BestFitLine.Color, <span class="keyword">...</span>
                <span class="string">"ValueChangedFcn"</span>, @obj.onLineColorPicked );
            obj.LineColorPicker.Layout.Column = [1, 2];

            <span class="comment">% Scatter plot marker selector.</span>
            uilabel( <span class="string">"Parent"</span>, controlLayout, <span class="keyword">...</span>
                <span class="string">"Text"</span>, <span class="string">"Scatter plot marker:"</span> );
            obj.MarkerDropDown = uidropdown( <span class="keyword">...</span>
                <span class="string">"Parent"</span>, controlLayout, <span class="keyword">...</span>
                <span class="string">"Items"</span>, set( obj.ScatterSeries, <span class="string">"Marker"</span> ), <span class="keyword">...</span>
                <span class="string">"Tooltip"</span>, <span class="string">"Select the marker for the scatter plot"</span>, <span class="keyword">...</span>
                <span class="string">"Value"</span>, obj.ScatterSeries.Marker, <span class="keyword">...</span>
                <span class="string">"ValueChangedFcn"</span>, @obj.onMarkerSelected );

            <span class="comment">% Check boxes for the gridlines.</span>
            obj.XGridCheckBox = uicheckbox( <span class="keyword">...</span>
                <span class="string">"Parent"</span>, controlLayout, <span class="keyword">...</span>
                <span class="string">"Value"</span>, matlab.lang.OnOffSwitchState( obj.XGrid ), <span class="keyword">...</span>
                <span class="string">"Tag"</span>, <span class="string">"X"</span>, <span class="keyword">...</span>
                <span class="string">"Text"</span>, <span class="string">"Show x-gridlines"</span>, <span class="keyword">...</span>
                <span class="string">"Tooltip"</span>, <span class="string">"Toggle the vertical axes gridlines"</span>, <span class="keyword">...</span>
                <span class="string">"ValueChangedFcn"</span>, @obj.onGridSelected );
            obj.XGridCheckBox.Layout.Column = [1, 2];
            obj.YGridCheckBox = uicheckbox( <span class="keyword">...</span>
                <span class="string">"Parent"</span>, controlLayout, <span class="keyword">...</span>
                <span class="string">"Value"</span>, matlab.lang.OnOffSwitchState( obj.YGrid ), <span class="keyword">...</span>
                <span class="string">"Tag"</span>, <span class="string">"Y"</span>, <span class="keyword">...</span>
                <span class="string">"Text"</span>, <span class="string">"Show y-gridlines"</span>, <span class="keyword">...</span>
                <span class="string">"Tooltip"</span>, <span class="string">"Toggle the horizontal axes gridlines"</span>, <span class="keyword">...</span>
                <span class="string">"ValueChangedFcn"</span>, @obj.onGridSelected );
            obj.YGridCheckBox.Layout.Column = [1, 2];

        <span class="keyword">end</span> <span class="comment">% setup</span>

        <span class="keyword">function</span> update( obj )
            <span class="comment">%UPDATE Refresh the chart graphics.</span>

            <span class="keyword">if</span> obj.ComputationRequired

                <span class="comment">% Update the scatter series with the new data.</span>
                set( obj.ScatterSeries, <span class="string">"XData"</span>, obj.XData_, <span class="keyword">...</span>
                    <span class="string">"YData"</span>, obj.YData_ )
                <span class="comment">% Compute the new best-fit line. Suppress any rank deficiency</span>
                <span class="comment">% warning from the regression, if necessary, then restore the</span>
                <span class="comment">% user's warning preference. Handle empty chart data as a</span>
                <span class="comment">% separate case as this causes an error when using the fitlm</span>
                <span class="comment">% function.</span>
                <span class="keyword">if</span> ~isempty( obj.XData_ )
                    <span class="comment">% Handle the possible rank deficiency warning.</span>
                    w = warning( <span class="string">"query"</span>, obj.FitWarningID );
                    oc = onCleanup( @() warning( w ) );
                    warning( <span class="string">"off"</span>, obj.FitWarningID )
                    mdl = fitlm( obj.XData_, obj.YData_ );
                    <span class="comment">% Update the line graphics.</span>
                    [~, posMin] = min( obj.XData_ );
                    [~, posMax] = max( obj.XData_ );
                    set( obj.BestFitLine, <span class="keyword">...</span>
                        <span class="string">"XData"</span>, obj.XData_([posMin, posMax]), <span class="keyword">...</span>
                        <span class="string">"YData"</span>, mdl.Fitted([posMin, posMax]) )
                    <span class="comment">% Update the equation label.</span>
                    obj.SummaryLabel.Text = modelSummary( mdl );
                <span class="keyword">else</span>
                    <span class="comment">% This is the empty data case. Update the line and the</span>
                    <span class="comment">% label.</span>
                    set( obj.BestFitLine, <span class="string">"XData"</span>, obj.XData_, <span class="keyword">...</span>
                        <span class="string">"YData"</span>, obj.YData_ )
                    obj.SummaryLabel.Text = <span class="string">""</span>;
                <span class="keyword">end</span> <span class="comment">% if</span>

                <span class="comment">% Mark the chart clean.</span>
                obj.ComputationRequired = false;

            <span class="keyword">end</span> <span class="comment">% if</span>

            <span class="comment">% Refresh the chart's decorative properties.</span>
            set( obj.ScatterSeries, <span class="string">"CData"</span>, obj.CData, <span class="keyword">...</span>
                <span class="string">"SizeData"</span>, obj.SizeData )

        <span class="keyword">end</span> <span class="comment">% update</span>

    <span class="keyword">end</span> <span class="comment">% methods ( Access = protected )</span>

    <span class="keyword">methods</span> ( Access = private )

        <span class="keyword">function</span> onToggleButtonPressed( obj, ~, ~ )
            <span class="comment">%ONTOGGLEBUTTONPRESSED Hide/show the chart controls.</span>

            toggleDown = obj.ToggleButton.Value;

            <span class="keyword">if</span> toggleDown
                <span class="comment">% Show the controls.</span>
                obj.LayoutGrid.ColumnWidth{2} = <span class="string">"fit"</span>;
                obj.ToggleButton.Tooltip = <span class="string">"Hide chart controls"</span>;
            <span class="keyword">else</span>
                <span class="comment">% Hide the controls.</span>
                obj.LayoutGrid.ColumnWidth{2} = <span class="string">"0x"</span>;
                obj.ToggleButton.Tooltip = <span class="string">"Show chart controls"</span>;
            <span class="keyword">end</span> <span class="comment">% if</span>

        <span class="keyword">end</span> <span class="comment">% onToggleButtonPressed</span>

        <span class="keyword">function</span> toggleLineVisibility( obj, s, ~ )
            <span class="comment">%TOGGLELINEVISIBILITY Toggle the visibility of the best-fit</span>
            <span class="comment">%line.</span>

            obj.BestFitLine.Visible = s.Value;

        <span class="keyword">end</span> <span class="comment">% toggleLineVisibility</span>

        <span class="keyword">function</span> onLineWidthSelected( obj, s, ~ )
            <span class="comment">%ONLINEWIDTHSELECTED Update the chart when the width of the</span>
            <span class="comment">%best-fit line is selected interactively.</span>

            obj.BestFitLine.LineWidth = s.Value;

        <span class="keyword">end</span> <span class="comment">% onLineWidthSelected</span>

        <span class="keyword">function</span> onLineStyleSelected( obj, s, ~ )
            <span class="comment">%ONLINESTYLESELECTED Update the chart when the style of the</span>
            <span class="comment">%best-fit line is selected interactively.</span>

            obj.BestFitLine.LineStyle = s.Value;

        <span class="keyword">end</span> <span class="comment">% onLineStyleSelected</span>

        <span class="keyword">function</span> onLineColorPicked( obj, ~, ~ )
            <span class="comment">%ONLINECOLORPICKED Allow the user to select a new color</span>
            <span class="comment">%for the best-fit line.</span>

            <span class="comment">% Update the line's color.</span>
            obj.LineColor = obj.LineColorPicker.Value;

        <span class="keyword">end</span> <span class="comment">% onLineColorPicked</span>

        <span class="keyword">function</span> onMarkerSelected( obj, s, ~ )
            <span class="comment">%ONMARKERSELECTED Update the chart when the scatter plot marker</span>
            <span class="comment">%is selected interactively.</span>

            obj.ScatterSeries.Marker = s.Value;

        <span class="keyword">end</span> <span class="comment">% onMarkerSelected</span>

        <span class="keyword">function</span> onGridSelected( obj, s, ~ )
            <span class="comment">%ONGRIDSELECTED Toggle the x/y grid lines.</span>

            gridProp = s.Tag + <span class="string">"Grid"</span>;
            obj.Axes.(gridProp) = s.Value;

        <span class="keyword">end</span> <span class="comment">% onGridSelected</span>

    <span class="keyword">end</span> <span class="comment">% methods ( Access = private )</span>

<span class="keyword">end</span> <span class="comment">% classdef</span>

<span class="keyword">function</span> s = modelSummary( mdl )
<span class="comment">%MODELSUMMARY Given a linear regression model mdl representing a best-fit</span>
<span class="comment">%line, format the equation of the line and other model properties as a</span>
<span class="comment">%string.</span>

<span class="comment">% Compute the residual norm, excluding missing observations.</span>
res = mdl.Residuals.Raw;
resNorm = norm( res(~ismissing( res )) );
<span class="comment">% Extract the model coefficients.</span>
coeffs = mdl.Coefficients.Estimate;
m = coeffs(2); <span class="comment">% Gradient</span>
c = coeffs(1); <span class="comment">% Intercept</span>
<span class="keyword">if</span> c &gt;= 0
    interceptSign = <span class="string">"+"</span>;
<span class="keyword">else</span>
    interceptSign = <span class="string">"-"</span>;
<span class="keyword">end</span> <span class="comment">% if</span>
gradientText = num2str( m, <span class="string">"%g"</span> );
interceptText = num2str( abs( c ), <span class="string">"%g"</span> );
s = <span class="string">"Best-fit line equation:"</span> + newline() + newline() + <span class="keyword">...</span>
    <span class="string">"y = "</span> + gradientText + <span class="string">"x"</span> + <span class="keyword">...</span>
    interceptSign + interceptText + newline() + newline() + <span class="keyword">...</span>
    <span class="string">"Gradient: "</span> + gradientText + newline() + <span class="keyword">...</span>
    <span class="string">"Intercept: "</span> + interceptSign + interceptText + newline() + <span class="keyword">...</span>
    <span class="string">"Number of observations: "</span> + <span class="keyword">...</span>
    num2str( mdl.NumObservations, <span class="string">"%g"</span> ) + newline() + <span class="keyword">...</span>
    <span class="string">"MSE: "</span> + num2str( mdl.MSE, <span class="string">"%g"</span> ) + newline() + <span class="keyword">...</span>
    <span class="string">"RMSE: "</span> + num2str( mdl.RMSE, <span class="string">"%g"</span> ) + newline() + <span class="keyword">...</span>
    <span class="string">"R"</span> + char( 178 ) + <span class="string">": "</span> + <span class="keyword">...</span>
    num2str( mdl.Rsquared.Ordinary, <span class="string">"%g"</span> ) + newline() + <span class="keyword">...</span>
    <span class="string">"Residual norm: "</span> + num2str( resNorm, <span class="string">"%g"</span> );

<span class="keyword">end</span> <span class="comment">% modelSummary</span>
</pre>
</div>
<!--
##### SOURCE BEGIN #####
classdef ScatterFitChart < Component
    %SCATTERFITCHART Chart component managing 2D scattered data (x and y)
    %together with the corresponding best-fit line.

    % Copyright 2018-2025 The MathWorks, Inc.

    properties ( Dependent )
        % Chart x-data.
        XData(:, 1) double {mustBeReal}
        % Chart y-data.
        YData(:, 1) double {mustBeReal}
    end % properties ( Dependent )

    properties
        % Size data for the scatter series.
        SizeData(:, 1) double {mustBePositive, mustBeFinite} = 36
        % Color data for the scatter series.
        CData(:, 3) double ...
            {mustBeInRange( CData, 0, 1 )} = [0, 0.4470, 0.7410]
    end % properties

    properties ( Dependent )
        % Visibility of the best-fit line.
        LineVisible(1, 1) matlab.lang.OnOffSwitchState
        % Width of the best-fit line.
        LineWidth(1, 1) double {mustBePositive, mustBeFinite}
        % Style of the best-fit line.
        LineStyle(1, 1) string {mustBeLineStyle}
        % Scatter series marker.
        Marker(1, 1) string {mustBeMarker}
        % Color of the best-fit line.
        LineColor
        % Axes x-grid.
        XGrid(1, 1) matlab.lang.OnOffSwitchState
        % Axes y-grid.
        YGrid(1, 1) matlab.lang.OnOffSwitchState
        % Visibility of the chart controls.
        Controls(1, 1) matlab.lang.OnOffSwitchState
    end % properties ( Dependent )

    properties ( Access = private )
        % Internal storage for the XData property.
        XData_(:, 1) double {mustBeReal} = double.empty( 0, 1 )
        % Internal storage for the YData property.
        YData_(:, 1) double {mustBeReal} = double.empty( 0, 1 )
        % Logical scalar specifying whether a computation is required.
        ComputationRequired(1, 1) logical = false
    end % properties ( Access = private )

    properties ( Access = private, Transient, NonCopyable )
        % Chart layout.
        LayoutGrid(:, 1) matlab.ui.container.GridLayout ...
            {mustBeScalarOrEmpty}
        % Chart axes.
        Axes(:, 1) matlab.graphics.axis.Axes {mustBeScalarOrEmpty}
        % Toggle button for the chart controls.
        ToggleButton(:, 1) matlab.ui.controls.ToolbarStateButton ...
            {mustBeScalarOrEmpty}
        % Scatter series for the (x, y) data.
        ScatterSeries(:, 1) matlab.graphics.chart.primitive.Scatter ...
            {mustBeScalarOrEmpty}
        % Line object for the best-fit line.
        BestFitLine(:, 1) matlab.graphics.primitive.Line ...
            {mustBeScalarOrEmpty}
        % Label to display a summary of the best-fit line statistics.
        SummaryLabel(:, 1) matlab.ui.control.Label {mustBeScalarOrEmpty}
        % Check box for the best-fit line visibility.
        BestFitLineCheckBox(:, 1) matlab.ui.control.CheckBox ...
            {mustBeScalarOrEmpty}
        % Spinner for selecting the width of the best-fit line.
        LineWidthSpinner(:, 1) matlab.ui.control.Spinner ...
            {mustBeScalarOrEmpty}
        % Dropdown menu for selecting the style of the best-fit line.
        LineStyleDropDown(:, 1) matlab.ui.control.DropDown ...
            {mustBeScalarOrEmpty}
        % Dropdown menu for selecting the marker of the scatter plot.
        MarkerDropDown(:, 1) matlab.ui.control.DropDown ...
            {mustBeScalarOrEmpty}
        % Color picker for the best-fit line.
        LineColorPicker(:, 1) matlab.ui.control.ColorPicker ...
            {mustBeScalarOrEmpty}
        % Check box for the axes' XGrid visibility.
        XGridCheckBox(:, 1) matlab.ui.control.CheckBox ...
            {mustBeScalarOrEmpty}
        % Check box for the axes' YGrid visibility.
        YGridCheckBox(:, 1) matlab.ui.control.CheckBox ...
            {mustBeScalarOrEmpty}
    end % properties ( Access = private, Transient, NonCopyable )

    properties ( Constant, Hidden )
        % Product dependencies.
        Dependencies(1, :) string = ["MATLAB", ...
            "Statistics and Machine Learning Toolbox"]
        % Description.
        ShortDescription(1, 1) string = "Manage bivariate scattered" + ...
            " data together with the line of best fit"
    end % properties ( Constant, Hidden )

    properties ( Constant, GetAccess = private )
        % Warning ID which may arise when fitting the line.
        FitWarningID(1, 1) string = "stats:LinearModel:RankDefDesignMat"
    end % properties ( Constant, GetAccess = private )

    methods

        function value = get.XData( obj )

            value = obj.XData_;

        end % get.XData

        function set.XData( obj, value )

            % Mark the chart for an update.
            obj.ComputationRequired = true;

            % Decide how to modify the chart data.
            nX = numel( value );
            nY = numel( obj.YData_ );

            if nX < nY % If the new x-data is too short ...
                % ... then chop the chart y-data.
                obj.YData_ = obj.YData_(1:nX);
            else
                % Otherwise, if nX >= nY, then pad the y-data.
                obj.YData_(end+1:nX, 1) = NaN;
            end % if

            % Set the internal x-data.
            obj.XData_ = value;

            % Reset the scatter series' color and size data if necessary.
            nC = height( obj.CData );
            if nC > 1 && nX ~= nC
                obj.CData = obj.Axes.ColorOrder(1, :);
            end % if
            nS = numel( obj.SizeData );
            if nS > 1 && nX ~= nS
                obj.SizeData = 36;
            end % if

        end % set.XData

        function value = get.YData( obj )

            value = obj.YData_;

        end % get.YData

        function set.YData( obj, value )

            % Mark the chart for an update.
            obj.ComputationRequired = true;

            % Decide how to modify the chart data.
            nY = numel( value );
            nX = numel( obj.XData_ );

            if nY < nX % If the new y-data is too short ...
                % ... then chop the chart x-data.
                obj.XData_ = obj.XData_(1:nY);
            else
                % Otherwise, if nY >= nX, then pad the x-data.
                obj.XData_(end+1:nY, 1) = NaN;
            end % if

            % Set the internal y-data.
            obj.YData_ = value;

            % Reset the color and size data if necessary.
            nC = height( obj.CData );
            if nC > 1 && nY ~= nC
                obj.CData = obj.Axes.ColorOrder(1, :);
            end % if
            nS = numel( obj.SizeData );
            if nS > 1 && nY ~= nS
                obj.SizeData = 36;
            end % if

        end % set.YData

        function value = get.LineVisible( obj )

            value = obj.BestFitLine.Visible;

        end % get.LineVisible

        function set.LineVisible( obj, value )

            % Update the property.
            obj.BestFitLine.Visible = value;

            % Update the check box.
            obj.BestFitLineCheckBox.Value = value;

        end % set.LineVisible

        function value = get.LineWidth( obj )

            value = obj.BestFitLine.LineWidth;

        end % get.LineWidth

        function set.LineWidth( obj, value )

            % Update the property.
            obj.BestFitLine.LineWidth = value;
            % Update the spinner.
            obj.LineWidthSpinner.Value = value;

        end % set.LineWidth

        function value = get.LineStyle( obj )

            value = obj.BestFitLine.LineStyle;

        end % get.LineStyle

        function set.LineStyle( obj, value )

            % Update the property.
            obj.BestFitLine.LineStyle = value;

            % Update the dropdown menu.
            obj.LineStyleDropDown.Value = value;

        end % set.LineStyle

        function value = get.Marker( obj )

            value = obj.ScatterSeries.Marker;

        end % get.Marker

        function set.Marker( obj, value )

            % Update the property.
            obj.ScatterSeries.Marker = value;

            % Update the dropdown menu.
            obj.MarkerDropDown.Value = validatestring( value, ...
                obj.MarkerDropDown.Items );

        end % set.Marker

        function value = get.LineColor( obj )

            value = obj.BestFitLine.Color;

        end % get.LineColor

        function set.LineColor( obj, value )

            % Validate the proposed value.
            value = validatecolor( value );

            % Update the line.
            obj.BestFitLine.Color = value;

            % Update the color picker.            
            obj.LineColorPicker.Value = obj.LineColor;

        end % set.LineColor

        function value = get.XGrid( obj )

            value = obj.Axes.XGrid;

        end % set.XGrid

        function set.XGrid( obj, value )

            % Set the property.
            obj.Axes.XGrid = value;

            % Update the checkbox.
            obj.XGridCheckBox.Value = value;

        end % set.XGrid

        function value = get.YGrid( obj )

            value = obj.Axes.YGrid;

        end % get.YGrid

        function set.YGrid( obj, value )

            % Set the property.
            obj.Axes.YGrid = value;

            % Update the checkbox.
            obj.YGridCheckBox.Value = value;

        end % set.YGrid

        function value = get.Controls( obj )

            value = obj.ToggleButton.Value;

        end % get.Controls

        function set.Controls( obj, value )

            % Update the toggle button.
            obj.ToggleButton.Value = value;

            % Invoke the toggle button callback.
            obj.onToggleButtonPressed()

        end % set.Controls

    end % methods

    methods

        function obj = ScatterFitChart( namedArgs )
            %SCATTERFITCHART Construct a ScatterFitChart, given optional
            %name-value arguments.

            arguments ( Input )
                namedArgs.?ScatterFitChart
            end % arguments ( Input )            

            % Set any user-specified properties.
            set( obj, namedArgs )

        end % constructor

        function varargout = xlabel( obj, varargin )

            [varargout{1:nargout}] = xlabel( obj.Axes, varargin{:} );

        end % xlabel

        function varargout = ylabel( obj, varargin )

            [varargout{1:nargout}] = ylabel( obj.Axes, varargin{:} );

        end % ylabel

        function varargout = title( obj, varargin )

            [varargout{1:nargout}] = title( obj.Axes, varargin{:} );

        end % title

        function grid( obj, varargin )

            % Invoke grid on the axes.
            grid( obj.Axes, varargin{:} )

            % Ensure the controls are up-to-date. This can be done by
            % setting the XGrid/YGrid chart properties, which in turn will
            % refresh the controls.
            obj.XGrid = obj.Axes.XGrid;
            obj.YGrid = obj.Axes.YGrid;

        end % grid

        function varargout = legend( obj, varargin )

            [varargout{1:nargout}] = legend( obj.Axes, varargin{:} );

        end % legend

        function varargout = axis( obj, varargin )

            [varargout{1:nargout}] = axis( obj.Axes, varargin{:} );

        end % axis

        function exportgraphics( obj, varargin )

            exportgraphics( obj.Axes, varargin{:} )

        end % exportgraphics

    end % methods

    methods ( Access = protected )

        function setup( obj )
            %SETUP Initialize the chart graphics.

            % Define the layout grid.
            obj.LayoutGrid = uigridlayout( obj, [1, 2], ...
                "ColumnWidth", ["1x", "0x"] );

            % Create the chart's axes.
            obj.Axes = axes( "Parent", obj.LayoutGrid );

            % Add a state button to show/hide the chart's controls.
            tb = axtoolbar( obj.Axes, "default" );
            iconPath = fullfile( chartsRoot(), "charts", ...
                "images", "Cog.png" );
            obj.ToggleButton = axtoolbarbtn( tb, "state", ...
                "Value", "off", ...
                "Tooltip", "Show chart controls", ...
                "Icon", iconPath, ...
                "ValueChangedFcn", @obj.onToggleButtonPressed );

            % Create the scatter series.
            hold( obj.Axes, "on" )
            obj.ScatterSeries = scatter( obj.Axes, NaN, NaN, ".", ...
                "CData", obj.CData, ...
                "DisplayName", "Data" );
            hold( obj.Axes, "off" )

            % Create the line object for the best-fit line.
            obj.BestFitLine = line( obj.Axes, NaN, NaN, ...
                "LineWidth", 1.5, ...
                "Color", obj.Axes.ColorOrder(2, :), ...
                "DisplayName", "Best-fit line" );

            % Annotate the axes and add the legend.
            xlabel( obj.Axes, "x" )
            ylabel( obj.Axes, "y" )
            title( obj.Axes, "y vs. x" )
            legend( obj.Axes )

            % Add the chart controls.
            p = uipanel( "Parent", obj.LayoutGrid, ...
                "Title", "Chart Controls", ...
                "FontWeight", "bold" );
            p.Layout.Column = 2;
            controlLayout = uigridlayout( p, [8, 2], ...
                "RowHeight", repmat( "fit", 1, 8 ) );

            % Summary label.
            obj.SummaryLabel = uilabel( "Parent", controlLayout, ...
                "Text", "" );
            obj.SummaryLabel.Layout.Column = [1, 2];

            % Best-fit line visibility toggle.
            obj.BestFitLineCheckBox = uicheckbox( ...
                "Parent", controlLayout, ...
                "Value", true, ...
                "Text", "Show best-fit line", ...
                "Tooltip", ...
                "Hide or show the best-fit line", ...
                "ValueChangedFcn", @obj.toggleLineVisibility );
            obj.BestFitLineCheckBox.Layout.Column = [1, 2];

            % Best-fit line width selector.
            uilabel( "Parent", controlLayout, ...
                "Text", "Line width:" );
            obj.LineWidthSpinner = uispinner( "Parent", controlLayout, ...
                "Limits", [0, Inf], ...
                "LowerLimitInclusive", "off", ...
                "Step", 0.5, ...
                "Tooltip", "Select the width of the best-fit line", ...
                "Value", obj.BestFitLine.LineWidth, ...
                "ValueDisplayFormat", "%.1f", ...
                "ValueChangedFcn", @obj.onLineWidthSelected );

            % Best-fit line style selector.
            uilabel( "Parent", controlLayout, ...
                "Text", "Line style:" );
            obj.LineStyleDropDown = uidropdown( ...
                "Parent", controlLayout, ...
                "Items", set( obj.BestFitLine, "LineStyle" ), ...
                "Tooltip", "Select the style of the best-fit line", ...
                "Value", obj.BestFitLine.LineStyle, ...
                "ValueChangedFcn", @obj.onLineStyleSelected );

            % Best-fit line color selector.            
            obj.LineColorPicker = uicolorpicker( ...
                "Parent", controlLayout, ...                
                "Tooltip", "Select the color of the best-fit line", ...
                "Value", obj.BestFitLine.Color, ...
                "ValueChangedFcn", @obj.onLineColorPicked );
            obj.LineColorPicker.Layout.Column = [1, 2];

            % Scatter plot marker selector.
            uilabel( "Parent", controlLayout, ...
                "Text", "Scatter plot marker:" );
            obj.MarkerDropDown = uidropdown( ...
                "Parent", controlLayout, ...
                "Items", set( obj.ScatterSeries, "Marker" ), ...
                "Tooltip", "Select the marker for the scatter plot", ...
                "Value", obj.ScatterSeries.Marker, ...
                "ValueChangedFcn", @obj.onMarkerSelected );

            % Check boxes for the gridlines.
            obj.XGridCheckBox = uicheckbox( ...
                "Parent", controlLayout, ...
                "Value", matlab.lang.OnOffSwitchState( obj.XGrid ), ...
                "Tag", "X", ...
                "Text", "Show x-gridlines", ...
                "Tooltip", "Toggle the vertical axes gridlines", ...
                "ValueChangedFcn", @obj.onGridSelected );
            obj.XGridCheckBox.Layout.Column = [1, 2];
            obj.YGridCheckBox = uicheckbox( ...
                "Parent", controlLayout, ...
                "Value", matlab.lang.OnOffSwitchState( obj.YGrid ), ...
                "Tag", "Y", ...
                "Text", "Show y-gridlines", ...
                "Tooltip", "Toggle the horizontal axes gridlines", ...
                "ValueChangedFcn", @obj.onGridSelected );
            obj.YGridCheckBox.Layout.Column = [1, 2];

        end % setup

        function update( obj )
            %UPDATE Refresh the chart graphics.

            if obj.ComputationRequired

                % Update the scatter series with the new data.
                set( obj.ScatterSeries, "XData", obj.XData_, ...
                    "YData", obj.YData_ )
                % Compute the new best-fit line. Suppress any rank deficiency
                % warning from the regression, if necessary, then restore the
                % user's warning preference. Handle empty chart data as a
                % separate case as this causes an error when using the fitlm
                % function.
                if ~isempty( obj.XData_ )
                    % Handle the possible rank deficiency warning.
                    w = warning( "query", obj.FitWarningID );
                    oc = onCleanup( @() warning( w ) );
                    warning( "off", obj.FitWarningID )
                    mdl = fitlm( obj.XData_, obj.YData_ );
                    % Update the line graphics.
                    [~, posMin] = min( obj.XData_ );
                    [~, posMax] = max( obj.XData_ );
                    set( obj.BestFitLine, ...
                        "XData", obj.XData_([posMin, posMax]), ...
                        "YData", mdl.Fitted([posMin, posMax]) )
                    % Update the equation label.
                    obj.SummaryLabel.Text = modelSummary( mdl );
                else
                    % This is the empty data case. Update the line and the
                    % label.
                    set( obj.BestFitLine, "XData", obj.XData_, ...
                        "YData", obj.YData_ )
                    obj.SummaryLabel.Text = "";
                end % if

                % Mark the chart clean.
                obj.ComputationRequired = false;

            end % if

            % Refresh the chart's decorative properties.
            set( obj.ScatterSeries, "CData", obj.CData, ...
                "SizeData", obj.SizeData )

        end % update

    end % methods ( Access = protected )

    methods ( Access = private )

        function onToggleButtonPressed( obj, ~, ~ )
            %ONTOGGLEBUTTONPRESSED Hide/show the chart controls.

            toggleDown = obj.ToggleButton.Value;

            if toggleDown
                % Show the controls.
                obj.LayoutGrid.ColumnWidth{2} = "fit";
                obj.ToggleButton.Tooltip = "Hide chart controls";
            else
                % Hide the controls.
                obj.LayoutGrid.ColumnWidth{2} = "0x";
                obj.ToggleButton.Tooltip = "Show chart controls";
            end % if

        end % onToggleButtonPressed

        function toggleLineVisibility( obj, s, ~ )
            %TOGGLELINEVISIBILITY Toggle the visibility of the best-fit
            %line.

            obj.BestFitLine.Visible = s.Value;

        end % toggleLineVisibility

        function onLineWidthSelected( obj, s, ~ )
            %ONLINEWIDTHSELECTED Update the chart when the width of the
            %best-fit line is selected interactively.

            obj.BestFitLine.LineWidth = s.Value;

        end % onLineWidthSelected

        function onLineStyleSelected( obj, s, ~ )
            %ONLINESTYLESELECTED Update the chart when the style of the
            %best-fit line is selected interactively.

            obj.BestFitLine.LineStyle = s.Value;

        end % onLineStyleSelected

        function onLineColorPicked( obj, ~, ~ )
            %ONLINECOLORPICKED Allow the user to select a new color
            %for the best-fit line.

            % Update the line's color.
            obj.LineColor = obj.LineColorPicker.Value;

        end % onLineColorPicked

        function onMarkerSelected( obj, s, ~ )
            %ONMARKERSELECTED Update the chart when the scatter plot marker
            %is selected interactively.

            obj.ScatterSeries.Marker = s.Value;

        end % onMarkerSelected

        function onGridSelected( obj, s, ~ )
            %ONGRIDSELECTED Toggle the x/y grid lines.

            gridProp = s.Tag + "Grid";
            obj.Axes.(gridProp) = s.Value;

        end % onGridSelected

    end % methods ( Access = private )

end % classdef

function s = modelSummary( mdl )
%MODELSUMMARY Given a linear regression model mdl representing a best-fit
%line, format the equation of the line and other model properties as a
%string.

% Compute the residual norm, excluding missing observations.
res = mdl.Residuals.Raw;
resNorm = norm( res(~ismissing( res )) );
% Extract the model coefficients.
coeffs = mdl.Coefficients.Estimate;
m = coeffs(2); % Gradient
c = coeffs(1); % Intercept
if c >= 0
    interceptSign = "+";
else
    interceptSign = "-";
end % if
gradientText = num2str( m, "%g" );
interceptText = num2str( abs( c ), "%g" );
s = "Best-fit line equation:" + newline() + newline() + ...
    "y = " + gradientText + "x" + ...
    interceptSign + interceptText + newline() + newline() + ...
    "Gradient: " + gradientText + newline() + ...
    "Intercept: " + interceptSign + interceptText + newline() + ...
    "Number of observations: " + ...
    num2str( mdl.NumObservations, "%g" ) + newline() + ...
    "MSE: " + num2str( mdl.MSE, "%g" ) + newline() + ...
    "RMSE: " + num2str( mdl.RMSE, "%g" ) + newline() + ...
    "R" + char( 178 ) + ": " + ...
    num2str( mdl.Rsquared.Ordinary, "%g" ) + newline() + ...
    "Residual norm: " + num2str( resNorm, "%g" );

end % modelSummary
##### SOURCE END #####
-->
</body>
</html>
